<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Gmail Account Creator</title>
    <link rel="icon" type="image/x-icon" href="gmail.ico" id="faviconLink">
    <link rel="shortcut icon" type="image/x-icon" href="gmail.ico">
    <link rel="apple-touch-icon" href="gmail.ico">
    <link rel="stylesheet" href="style.css?v=2.0">
    <style>
        /* Navigation Tabs - Hidden */
        .nav-tabs {
            display: none !important;
        }
        .tab-content {
            display: none;
        }
        
        /* Responsive reset */
        * {
            box-sizing: border-box;
        }
        body {
            margin: 0;
            padding: 0;
            background: #121212;
        }
        .main-container {
            max-width: 1200px; /* desktop r·ªông h∆°n */
            margin: 0 auto;
            padding: 12px;
            min-width: 0;
        }
        .setup-card,
        .card {
            width: 100%;
            max-width: 1000px; /* k√©o d√†i kh·ªëi card h∆°n n·ªØa */
            box-sizing: border-box;
            margin-left: auto;
            margin-right: auto;
        }
        .setup-content {
            padding: 16px;
        }
        .setup-logo {
            margin: 8px auto 16px auto;
            text-align: center;
        }
        .setup-logo img {
            display: block;
            margin: 0 auto;
        }
        .setup-form .form-input,
        .setup-form .form-select,
        .setup-form select,
        .setup-form input {
            width: 100%;
            box-sizing: border-box;
        }
        .setup-actions button {
            width: 100%;
        }
        .accounts-container,
        .accounts-container .account-item,
        #accountsContainer,
        #accountsList {
            width: 100%;
            box-sizing: border-box;
        }
        .accounts-container .account-email {
            word-break: break-all;
            white-space: normal;
        }
        @media (max-width: 640px) {
            .main-container {
                max-width: 480px; /* mobile gi·ªØ nguy√™n */
                padding: 8px;
            }
            .setup-content {
                padding: 10px;
            }
            .setup-heading {
                text-align: center;
            }
            .setup-actions button {
                width: 100%;
            }
        }
        
        /* Mobile layout fixes */
        body {
            margin: 0;
            padding: 0;
            background: #121212;
        }
        .main-container {
            max-width: 480px;
            margin: 0 auto;
            padding: 12px;
        }
        .setup-card,
        .card {
            width: 100%;
            box-sizing: border-box;
        }
        .setup-content {
            padding: 12px;
        }
        .setup-logo {
            margin: 8px auto 16px auto;
            text-align: center;
        }
        .setup-logo img {
            display: block;
            margin: 0 auto;
        }
        .setup-form .form-input,
        .setup-form .form-select,
        .setup-form select,
        .setup-form input {
            width: 100%;
            box-sizing: border-box;
        }
        .setup-actions button {
            width: 100%;
        }
        .accounts-container,
        .accounts-list,
        .accounts-container .account-item,
        #accountsContainer,
        #accountsList {
            width: 100%;
            box-sizing: border-box;
        }
        @media (max-width: 640px) {
            .main-container {
                padding: 8px;
            }
            .setup-content {
                padding: 10px;
            }
            .setup-heading {
                text-align: center;
            }
        }
        
        /* Hide Footer only on Setup Task page */
        #tab-setup .btn-logout {
            display: none !important;
        }
        
        .footer.hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- TAB 1: SETUP (Show by default) -->
        <div id="tab-setup" class="tab-content" style="display: block;">
            <div class="card setup-card">
                <div class="setup-content">
                    <div class="setup-logo" id="gmailLogoContainer">
                        <!-- Logo s·∫Ω ƒë∆∞·ª£c load v√†o ƒë√¢y -->
                    </div>
                    <h1 class="setup-heading">Setup Task</h1>
                    <form class="setup-form" id="setupForm" onsubmit="handleSetup(event); return false;">
                        <div class="form-group">
                            <label class="form-label">Select Server Region</label>
                            <div class="select-wrapper">
                                <select id="serverRegion" name="serverRegion" class="form-select" required>
                                    <option value="us">üá∫üá∏ United States (Premium)</option>
                                    <option value="uk">üá¨üáß United Kingdom</option>
                                    <option value="de">üá©üá™ Germany</option>
                                    <option value="fr">üá´üá∑ France</option>
                                    <option value="jp">üáØüáµ Japan</option>
                                    <option value="sg">üá∏üá¨ Singapore</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Number of Accounts</label>
                            <input type="number" id="numberOfAccounts" name="numberOfAccounts" class="form-input" value="1" min="1" max="100" required>
                        </div>
                        <div class="setup-actions">
                            <button type="submit" class="btn-start-automation" id="startAutomationBtn">
                                <span>Start Automation</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- TAB: LICENSE CARD (Hi·ªÉn th·ªã khi ƒë√£ t·∫°o Gmail ƒë·∫ßu ti√™n) -->
        <div id="tab-license" class="tab-content" style="display: none;">
            <div class="card setup-card">
                <div class="setup-content">
                    <div class="setup-logo" id="licenseLogoContainer">
                        <!-- Logo m·∫∑c ƒë·ªãnh ƒë√£ b·ªã x√≥a - ch·ªâ hi·ªÉn th·ªã logo custom n·∫øu c√≥ upload -->
                    </div>
                    <h1 class="setup-heading" style="color: #EA4335;">Limit Reached!</h1>
                    
                    <div style="text-align: center; margin: 24px 0;">
                        <p style="color: #9AA0A6; font-size: 16px; margin-bottom: 16px; line-height: 1.6;">
                            <strong style="color: #FFFFFF;">Each IP can only create 1 account</strong> (Gmail or Moitasec) for free.
                        </p>
                        <p style="color: #9AA0A6; font-size: 16px; margin-bottom: 16px; line-height: 1.6;">
                            <strong style="color: #EA4335;">VPN/Proxy is strictly prohibited!</strong> The system will automatically detect and block.
                        </p>
                        <p style="color: #9AA0A6; font-size: 16px; margin-bottom: 24px; line-height: 1.6;">
                            To create more accounts, please contact us via Telegram to purchase a license.
                        </p>
                        
                        <!-- QR Code Telegram - ƒê√£ ·∫©n -->
                        
                        <!-- Avatar Telegram -->
                        <div style="margin: 24px 0; text-align: center;">
                            <div style="display: inline-block; width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #0088cc 0%, #0066aa 100%); display: flex; align-items: center; justify-content: center; margin: 0 auto; box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM16.64 8.8C16.49 10.38 15.84 14.22 15.51 15.99C15.37 16.74 15.09 16.99 14.83 17.02C14.25 17.07 13.81 16.64 13.25 16.27C12.37 15.69 11.87 15.33 11.02 14.77C10.03 14.12 10.67 13.76 11.24 13.18C11.39 13.03 14.95 9.7 15.05 9.39C15.06 9.36 15.07 9.22 14.99 9.14C14.92 9.06 14.8 9.09 14.71 9.11C14.56 9.15 12.18 10.75 8.02 13.01C7.49 13.33 7.01 13.49 6.59 13.48C6.12 13.47 5.23 13.24 4.55 13.04C3.75 12.8 3.12 12.67 3.18 12.25C3.21 12.04 3.52 11.81 4.05 11.56C7.47 9.95 10.13 8.73 12.02 7.9C15.36 6.42 16.05 6.22 16.45 6.22C16.54 6.22 16.78 6.25 16.95 6.39C17.09 6.5 17.14 6.66 17.16 6.75C17.18 6.84 17.2 7.07 17.18 7.25C17.15 7.5 16.64 8.8 16.64 8.8Z" fill="white"/>
                                </svg>
                            </div>
                            <div style="color: #9AA0A6; font-size: 14px; margin-top: 8px; font-weight: 500;">@guishanghaii</div>
                        </div>
                        
                        <!-- Button Link Telegram -->
                        <a href="https://t.me/guishanghaii" target="_blank" class="btn-telegram" style="display: inline-flex; align-items: center; justify-content: center; gap: 8px; background: linear-gradient(135deg, #0088cc 0%, #0066aa 100%); color: white; padding: 14px 40px; border-radius: 24px; text-decoration: none; font-weight: 500; font-size: 16px; margin-top: 16px; width: 100%; box-sizing: border-box; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0, 136, 204, 0.3);">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM16.64 8.8C16.49 10.38 15.84 14.22 15.51 15.99C15.37 16.74 15.09 16.99 14.83 17.02C14.25 17.07 13.81 16.64 13.25 16.27C12.37 15.69 11.87 15.33 11.02 14.77C10.03 14.12 10.67 13.76 11.24 13.18C11.39 13.03 14.95 9.7 15.05 9.39C15.06 9.36 15.07 9.22 14.99 9.14C14.92 9.06 14.8 9.09 14.71 9.11C14.56 9.15 12.18 10.75 8.02 13.01C7.49 13.33 7.01 13.49 6.59 13.48C6.12 13.47 5.23 13.24 4.55 13.04C3.75 12.8 3.12 12.67 3.18 12.25C3.21 12.04 3.52 11.81 4.05 11.56C7.47 9.95 10.13 8.73 12.02 7.9C15.36 6.42 16.05 6.22 16.45 6.22C16.54 6.22 16.78 6.25 16.95 6.39C17.09 6.5 17.14 6.66 17.16 6.75C17.18 6.84 17.2 7.07 17.18 7.25C17.15 7.5 16.64 8.8 16.64 8.8Z" fill="white"/>
                            </svg>
                            <span>Contact Telegram: @guishanghaii</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: CREATE ACCOUNT (Hidden by default) -->
        <div id="tab-create" class="tab-content" style="display: none;">
            <!-- Step 1: Nh·∫≠p t√™n -->
            <div class="card step" id="step1">
                <div class="card-content">
                    <div class="left-section">
                        <div class="google-logo">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                        </div>
                        <h1>Create Google Account</h1>
                        <p class="subtitle">Enter your name</p>
                    </div>
                    <div class="right-section">
                        <form class="registration-form" onsubmit="return false;">
                            <div class="form-group">
                                <input type="text" id="lastName" name="lastName" placeholder="Last name (optional)">
                            </div>
                            <div class="form-group">
                                <input type="text" id="firstName" name="firstName" placeholder="First name" required>
                            </div>
                            <div class="form-actions">
                                <button type="button" id="step1NextBtn" class="btn-primary">Next</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Step 2: Th√¥ng tin c∆° b·∫£n -->
            <div class="card step" id="step2" style="display: none;">
                <div class="card-content">
                    <div class="left-section">
                        <div class="google-logo">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                        </div>
                        <h1>Basic Information</h1>
                        <p class="subtitle">Enter your date of birth and gender</p>
                    </div>
                    <div class="right-section">
                        <form class="registration-form" onsubmit="return false;">
                            <div class="date-group">
                                <div class="form-group">
                                    <input type="number" id="day" name="day" placeholder="Day" min="1" max="31" required>
                                </div>
                                <div class="form-group">
                                    <select id="month" name="month" required>
                                        <option value="">Month</option>
                                        <option value="1">January</option>
                                        <option value="2">February</option>
                                        <option value="3">March</option>
                                        <option value="4">April</option>
                                        <option value="5">May</option>
                                        <option value="6">June</option>
                                        <option value="7">July</option>
                                        <option value="8">August</option>
                                        <option value="9">September</option>
                                        <option value="10">October</option>
                                        <option value="11">November</option>
                                        <option value="12">December</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <input type="number" id="year" name="year" placeholder="Year" min="1900" max="2024" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <select id="gender" name="gender" required>
                                    <option value="">Gender</option>
                                    <option value="male">Male</option>
                                    <option value="female">Female</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <a href="#" class="info-link">Why we ask for your date of birth and gender</a>
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="goToStep(1)">Back</button>
                                <button type="button" class="btn-primary" onclick="handleStep2(event)">Next</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Step 3: T·∫°o email -->
            <div class="card step" id="step3" style="display: none;">
                <div class="card-content">
                    <div class="left-section">
                        <div class="google-logo">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                        </div>
                        <h1>Create an email address</h1>
                        <p class="subtitle">Create a Gmail address to sign in to your Google Account</p>
                    </div>
                    <div class="right-section">
                        <form class="registration-form" onsubmit="return false;">
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="emailOption" value="suggested1" checked>
                                    <span id="suggestedEmail1"></span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="emailOption" value="suggested2">
                                    <span id="suggestedEmail2"></span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="emailOption" value="custom">
                                    <span>Create your own Gmail address</span>
                                </label>
                            </div>
                            <div id="customEmailGroup" style="display: none;" class="form-group">
                                <div class="email-input-wrapper">
                                    <input type="text" id="customEmail" placeholder="Create a Gmail address" pattern="[a-z0-9._]+">
                                    <span class="email-suffix">@gmail.com</span>
                                </div>
                                <p class="email-hint">You can use letters, numbers, and periods</p>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="goToStep(2)">Back</button>
                                <div style="display: flex; gap: 12px; margin-left: auto;">
                                    <button type="button" class="btn-secondary" id="useCurrentEmailBtn" onclick="showUseCurrentEmail()">Use your current email</button>
                                    <button type="button" class="btn-primary" onclick="handleStep3(event)">Next</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Step 3b: S·ª≠ d·ª•ng email hi·ªán t·∫°i -->
            <div class="card step" id="step3b" style="display: none;">
                <div class="card-content">
                    <div class="left-section">
                        <div class="google-logo">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                        </div>
                        <h1>Use your current email</h1>
                        <p class="subtitle">Enter the email address you want to use for your Google Account</p>
                    </div>
                    <div class="right-section">
                        <form class="registration-form" onsubmit="return false;">
                            <div class="form-group floating-label">
                                <input type="email" id="currentEmail" name="currentEmail" placeholder=" " required>
                                <label for="currentEmail">Email address</label>
                            </div>
                            <p class="info-text">You'll need to verify that this email belongs to you</p>
                            <a href="#" class="info-link" onclick="event.preventDefault(); goToStep(3);">Create a Gmail address</a>
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="goToStep(3)">Back</button>
                                <button type="button" class="btn-primary" onclick="handleStep3b(event)">Next</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Step 4: T·∫°o m·∫≠t kh·∫©u -->
            <div class="card step" id="step4" style="display: none;">
                <div class="card-content">
                    <div class="left-section">
                        <div class="google-logo">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                        </div>
                        <h1>Create a strong password</h1>
                        <p class="subtitle">Create a strong password with a mix of letters, numbers, and symbols</p>
                    </div>
                    <div class="right-section">
                        <form class="registration-form" onsubmit="return false;">
                            <div class="form-group floating-label">
                                <input type="password" id="password" name="password" placeholder=" " required minlength="8">
                                <label for="password">Password</label>
                            </div>
                            <div class="form-group floating-label">
                                <input type="password" id="confirmPassword" name="confirmPassword" placeholder=" " required>
                                <label for="confirmPassword">Confirm</label>
                            </div>
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="showPassword">
                                    <span>Show password</span>
                                </label>
                            </div>
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" onclick="goToPreviousStep()">Back</button>
                                <button type="button" class="btn-primary" onclick="handleStep4(event)">Next</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Success Modal -->
            <div id="successModal" class="success-modal" style="display: none;">
                <div class="success-modal-content">
                    <div class="success-icon">
                        <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="60" cy="60" r="60" fill="#34A853" opacity="0.1"/>
                            <circle cx="60" cy="60" r="50" fill="#34A853"/>
                            <path d="M40 60L55 75L80 45" stroke="white" stroke-width="7" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h2 class="success-title">Success!</h2>
                    <p class="success-message" id="successCountMessage">All accounts created successfully</p>
                    <button type="button" class="btn-success-close" onclick="closeSuccessModal()">Close</button>
                </div>
            </div>

                </div>
            </div>

            <!-- Accounts List -->
            <div id="accountsList" class="accounts-list" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
                    <h2 style="flex: 1; min-width: 200px;">Created Accounts List</h2>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; width: 100%;">
                        <button type="button" class="btn-download" onclick="downloadAccounts('text')" style="background-color: #34A853; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; min-height: 44px; flex: 1; min-width: 100px; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">
                            Download TXT
                        </button>
                        <button type="button" class="btn-download" onclick="downloadAccounts('json')" style="background-color: #8AB4F8; color: #202124; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; min-height: 44px; flex: 1; min-width: 100px; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">
                            Download JSON
                        </button>
                        <button type="button" onclick="goToSetupTask()" style="background-color: #5F6368; color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; min-height: 44px; flex: 1; min-width: 100px; -webkit-tap-highlight-color: transparent; touch-action: manipulation;">
                            Back to Setup Task
                        </button>
                    </div>
                </div>
                <div id="accountsContainer" class="accounts-container">
                    <p class="empty-message">No accounts yet. Create your first account!</p>
                </div>
            </div>
        </div>

        <!-- TAB 3: ADMIN (Hidden by default) -->
        <div id="tab-admin" class="tab-content" style="display: none;">
            <div class="card setup-card">
                <div class="setup-content">
                    <h1 class="setup-heading">Admin Panel</h1>
                    <!-- Logo Management Section -->
                    <h2 class="setup-heading" style="font-size: 20px; margin-bottom: 16px; margin-top: 0;">Upload Logo</h2>
                    <form class="setup-form" id="logoUploadForm" onsubmit="return false;">
                        <div class="form-group">
                            <label class="form-label">Select Logo Image</label>
                            <input type="file" id="logoInput" name="logo" accept="image/*" class="form-input" style="padding: 8px;">
                        </div>
                        <div class="setup-actions">
                            <button type="submit" class="btn-start-automation">
                                <span>Upload Logo</span>
                            </button>
                        </div>
                    </form>
                    <div id="logoMessage" style="margin-top: 16px; padding: 12px; border-radius: 4px; display: none;"></div>
                    
                    <!-- Favicon Management Section -->
                    <hr style="margin: 32px 0; border: none; border-top: 1px solid #5F6368;">
                    <h2 class="setup-heading" style="font-size: 20px; margin-bottom: 16px;">Upload Favicon</h2>
                    <form class="setup-form" id="faviconUploadForm" onsubmit="return false;">
                        <div class="form-group">
                            <label class="form-label">Select Favicon Image</label>
                            <input type="file" id="faviconInput" name="favicon" accept="image/*" class="form-input" style="padding: 8px;">
                        </div>
                        <div class="setup-actions">
                            <button type="submit" class="btn-start-automation">
                                <span>Upload Favicon</span>
                            </button>
                        </div>
                    </form>
                    <div id="faviconMessage" style="margin-top: 16px; padding: 12px; border-radius: 4px; display: none;"></div>
                    
                    <!-- Admin Password Section -->
                    <hr style="margin: 32px 0; border: none; border-top: 1px solid #5F6368;">
                    <h2 class="setup-heading" style="font-size: 20px; margin-bottom: 16px;">Change Admin Password</h2>
                    <form class="setup-form" id="changePasswordForm" onsubmit="return false;">
                        <div class="form-group">
                            <label class="form-label">Current Password</label>
                            <input type="password" id="currentPassword" name="currentPassword" class="form-input" placeholder="Enter current password" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">New Password</label>
                            <input type="password" id="newPassword" name="newPassword" class="form-input" placeholder="Enter new password" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirm New Password</label>
                            <input type="password" id="confirmNewPassword" name="confirmNewPassword" class="form-input" placeholder="Confirm new password" required minlength="6">
                        </div>
                        <div class="setup-actions">
                            <button type="submit" class="btn-start-automation">
                                <span>Change Password</span>
                            </button>
                        </div>
                    </form>
                    <div id="passwordMessage" style="margin-top: 16px; padding: 12px; border-radius: 4px; display: none;"></div>
                    
                    <!-- Import Accounts Section -->
                    <hr style="margin: 32px 0; border: none; border-top: 1px solid #5F6368;">
                    <h2 class="setup-heading" style="font-size: 20px; margin-bottom: 16px;">Import Gmail/Moitasec Accounts</h2>
                    <div style="margin-bottom: 16px;">
                        <label class="form-label">Paste account list (format: email|password, m·ªói d√≤ng 1 account)</label>
                        <textarea id="accountListInput" class="form-input" rows="10" placeholder="email1@gmail.com|password1&#10;email2@moitasec.com|password2&#10;..."></textarea>
                    </div>
                    <div class="setup-actions">
                        <button type="button" class="btn-start-automation" onclick="importAccountList()">
                            <span>Import Accounts</span>
                        </button>
                    </div>
                    <div id="importMessage" style="margin-top: 16px; padding: 12px; border-radius: 4px; display: none;"></div>
                    
                    <!-- IP Management Section -->
                    <hr style="margin: 32px 0; border: none; border-top: 1px solid #5F6368;">
                    <h2 class="setup-heading" style="font-size: 20px; margin-bottom: 16px;">IP Management</h2>
                    <div id="ipManagementSection">
                        <div id="ipListContainer" style="margin-top: 24px;">
                            <h3 style="font-size: 16px; color: #FFFFFF; margin-bottom: 12px;">Accessed IPs List:</h3>
                            <div id="ipList" style="display: flex; flex-direction: column; gap: 12px;">
                                <!-- IP list will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 32px;">
                        <button type="button" class="btn-logout" onclick="document.getElementById('tab-admin').style.display='none'; document.getElementById('tab-setup').style.display='block'; updateFooterVisibility();">
                            <span>Back to Setup</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

        </div>
    </div>

    <!-- Footer - N·∫±m ·ªü d∆∞·ªõi c√πng -->
    <div class="footer">
        <div class="footer-left">
            <select id="language" class="language-select">
                <option value="vi">Vietnamese</option>
                <option value="en">English</option>
            </select>
        </div>
        <div class="footer-right">
            <a href="#" class="footer-link">Help</a>
            <a href="#" class="footer-link">Privacy</a>
            <a href="#" class="footer-link">Terms</a>
        </div>
    </div>

    <script src="script.js?v=2.1"></script>
    <script>
        // ·∫®n/hi·ªán footer d·ª±a tr√™n tab ƒëang hi·ªÉn th·ªã
        function updateFooterVisibility() {
            const tabSetup = document.getElementById('tab-setup');
            const footer = document.querySelector('.footer');
            
            if (tabSetup && footer) {
                // N·∫øu tab-setup ƒëang hi·ªÉn th·ªã, ·∫©n footer
                if (tabSetup.style.display === 'block' || 
                    window.getComputedStyle(tabSetup).display === 'block') {
                    footer.classList.add('hidden');
                } else {
                    footer.classList.remove('hidden');
                }
            }
        }
        
        // Ki·ªÉm tra khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            updateFooterVisibility();
            
            // Theo d√µi thay ƒë·ªïi display c·ªßa tab-setup
            const tabSetup = document.getElementById('tab-setup');
            if (tabSetup) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                            updateFooterVisibility();
                        }
                    });
                });
                
                observer.observe(tabSetup, {
                    attributes: true,
                    attributeFilter: ['style']
                });
            }
        });
    </script>
    <script>
        // Tab Navigation (disabled - tabs are hidden)
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.getElementById(`tab-${tabName}`).style.display = 'block';
        }

        // Setup functions (from setup.html)
        const firstNames = ['Perry', 'Allan', 'Marshall', 'Billy', 'Larry', 'Jacob', 'Michael', 'Earl', 'Tyler', 'Scott', 'James', 'Robert', 'John', 'David', 'William', 'Richard', 'Joseph', 'Thomas', 'Charles', 'Daniel'];
        const lastNames = ['Montgomery', 'Sierra', 'Aguirre', 'Pollard', 'Houston', 'Person', 'Pruitt', 'Duffy', 'Dodson', 'Pineda', 'Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez'];
        const middleParts = ['Puh', 'Xon', 'Xav', 'Pax', 'Koj', 'Pul', 'Vah', 'Wug', 'Qun', 'Hur', 'Zob', 'Vas', 'Bab', 'Duz', 'Lur', 'Sal', 'Nob', 'Tuz', 'Kur', 'Wab'];
        
        function randomString(length, type = 'mixed') {
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
            const numbers = '0123456789';
            let chars = type === 'letters' ? letters : (type === 'numbers' ? numbers : letters + numbers);
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        function randomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        // Danh s√°ch t√†i kho·∫£n c√≥ s·∫µn ƒë·ªÉ random
        // Danh s√°ch t√†i kho·∫£n Gmail/Moitasec t·ª´ user (s·∫Ω ƒë∆∞·ª£c load t·ª´ localStorage ho·∫∑c import)
        let predefinedAccounts = [];
        
        // Load danh s√°ch accounts t·ª´ localStorage n·∫øu c√≥, n·∫øu kh√¥ng th√¨ d√πng danh s√°ch m·∫∑c ƒë·ªãnh
        function loadPredefinedAccounts() {
            const savedAccounts = localStorage.getItem('predefinedAccounts');
            if (savedAccounts) {
                try {
                    predefinedAccounts = JSON.parse(savedAccounts);
                    console.log('‚úÖ ƒê√£ load', predefinedAccounts.length, 't√†i kho·∫£n t·ª´ localStorage');
                } catch (e) {
                    console.error('‚ùå L·ªói khi parse predefinedAccounts:', e);
                    predefinedAccounts = [];
                }
            }
            
            // N·∫øu ch∆∞a c√≥ trong localStorage, d√πng danh s√°ch m·∫∑c ƒë·ªãnh
            if (predefinedAccounts.length === 0) {
                console.log('‚ö†Ô∏è Ch∆∞a c√≥ danh s√°ch trong localStorage, load danh s√°ch m·∫∑c ƒë·ªãnh...');
                const defaultAccountList = `PerryMontgomeryPuh64627@moitasec.com|Pob45516
AllanSierraXon35421Map97871@moitasec.com|Fuw22561
MarshallAguirreXav18436Cuy15340@moitasec.com|Jan10568
BillyPollardPax81080Puw53579@moitasec.com|Yal01029
LarryHoustonKoj97931Zob18470@moitasec.com|Cub78920
JacobPersonPul70973Vas73297@moitasec.com|Ton07643
MichaelPruittVah26288Bab57863@moitasec.com|Noj45409
EarlDuffyWug16843Duz59427@moitasec.com|Nas20474
TylerDodsonQun61090Lur35065@moitasec.com|Has21335
ScottPinedaHur10700Sal43681@moitasec.com|Gap88771
LewisRobbinsHow21627Kaf78266@moitasec.com|Joy25116
EugeneDeleonJuq29125Dac08557@moitasec.com|Suq96229
VincentHancockXaq43615Jof07469@moitasec.com|Kag62608
KarlMunozVaz36370Kav94308@moitasec.com|Tuk42491
ApolinarioValentineRad49385Daf07596@moitasec.com|Rom19630
JackRiversBat02097Nut37587@moitasec.com|Dun05183
MartinFieldsGus33787Jab90093@moitasec.com|Qop13079
AbordoLyndaGaq91817Xan53250@moitasec.com|Sah06600
MiltonLealNow01126Fum26548@moitasec.com|Poy74768
RossPalaciosZof59279Fad73077@moitasec.com|Sup39973`;
                
                const count = importAccounts(defaultAccountList);
                console.log('‚úÖ ƒê√£ load', count, 't√†i kho·∫£n m·∫∑c ƒë·ªãnh');
            }
        }
        
        // Import danh s√°ch accounts t·ª´ text (format: email|password ho·∫∑c email|password|firstName|lastName, m·ªói d√≤ng 1 account)
        function importAccounts(accountText) {
            const lines = accountText.split('\n').filter(line => line.trim());
            predefinedAccounts = [];
            
            lines.forEach((line, index) => {
                const parts = line.trim().split('|');
                if (parts.length >= 2) {
                    const email = parts[0].trim();
                    const password = parts[1].trim();
                    
                    // Extract firstName v√† lastName t·ª´ email n·∫øu kh√¥ng c√≥
                    let firstName = '';
                    let lastName = '';
                    
                    if (parts.length >= 4) {
                        // C√≥ firstName v√† lastName trong input
                        firstName = parts[2].trim();
                        lastName = parts[3].trim();
                    } else {
                        // T·ª± ƒë·ªông extract t·ª´ email
                        const emailPrefix = email.split('@')[0];
                        // T√°ch theo ch·ªØ c√°i ƒë·∫ßu vi·∫øt hoa (v√≠ d·ª•: PerryMontgomeryPuh64627 -> Perry, Montgomery)
                        const nameMatch = emailPrefix.match(/^([A-Z][a-z]+)([A-Z][a-z]+)/);
                        if (nameMatch) {
                            firstName = nameMatch[1];
                            lastName = nameMatch[2];
                        } else {
                            // Fallback: l·∫•y ph·∫ßn ƒë·∫ßu l√†m firstName
                            const firstCapital = emailPrefix.match(/^([A-Z][a-z]+)/);
                            firstName = firstCapital ? firstCapital[1] : emailPrefix.substring(0, 10);
                            lastName = '';
                        }
                    }
                    
                    predefinedAccounts.push({
                        email: email,
                        password: password,
                        firstName: firstName || 'User',
                        lastName: lastName || ''
                    });
                } else {
                    console.warn('‚ö†Ô∏è D√≤ng', index + 1, 'kh√¥ng ƒë√∫ng format:', line);
                }
            });
            
            // SHUFFLE danh s√°ch ƒë·ªÉ ƒë·∫£m b·∫£o random th·ª±c s·ª±, kh√¥ng theo th·ª© t·ª±
            for (let i = predefinedAccounts.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [predefinedAccounts[i], predefinedAccounts[j]] = [predefinedAccounts[j], predefinedAccounts[i]];
            }
            
            // L∆∞u v√†o localStorage
            localStorage.setItem('predefinedAccounts', JSON.stringify(predefinedAccounts));
            localStorage.removeItem('usedMoitasecAccounts'); // Reset danh s√°ch ƒë√£ d√πng
            
            console.log('‚úÖ ƒê√£ import', predefinedAccounts.length, 't√†i kho·∫£n (ƒë√£ shuffle random)');
            return predefinedAccounts.length;
        }
        
        // Load accounts khi trang load
        loadPredefinedAccounts();

        function generateMoitasecAccount() {
            // CH·ªà d√πng t√†i kho·∫£n t·ª´ danh s√°ch user cung c·∫•p, KH√îNG random t·∫°o m·ªõi
            // ƒê·∫£m b·∫£o load l·∫°i t·ª´ localStorage m·ªói l·∫ßn (ƒë·ªÉ c√≥ danh s√°ch m·ªõi nh·∫•t)
            const savedAccounts = localStorage.getItem('predefinedAccounts');
            if (savedAccounts) {
                try {
                    predefinedAccounts = JSON.parse(savedAccounts);
                } catch (e) {
                    console.error('‚ùå L·ªói khi parse predefinedAccounts:', e);
                }
            }
            
            if (predefinedAccounts.length === 0) {
                console.error('‚ùå Ch∆∞a c√≥ danh s√°ch t√†i kho·∫£n! Vui l√≤ng import danh s√°ch tr∆∞·ªõc.');
                alert('Ch∆∞a c√≥ danh s√°ch t√†i kho·∫£n! Vui l√≤ng import danh s√°ch trong Admin Panel.');
                return null;
            }
            
            // L·∫•y danh s√°ch accounts ƒë√£ s·ª≠ d·ª•ng t·ª´ localStorage
            const usedAccounts = JSON.parse(localStorage.getItem('usedMoitasecAccounts') || '[]');
            
            // L·ªçc ra c√°c accounts ch∆∞a ƒë∆∞·ª£c s·ª≠ d·ª•ng
            const availableAccounts = predefinedAccounts.filter(acc => !usedAccounts.includes(acc.email));
            
            // RANDOM th·ª±c s·ª± - ch·ªçn ng·∫´u nhi√™n t·ª´ danh s√°ch available
            let selectedAccount;
            if (availableAccounts.length > 0) {
                // Random index t·ª´ 0 ƒë·∫øn availableAccounts.length - 1
                const randomIndex = Math.floor(Math.random() * availableAccounts.length);
                selectedAccount = availableAccounts[randomIndex];
            } else {
                // N·∫øu ƒë√£ d√πng h·∫øt, reset v√† ch·ªçn random t·ª´ to√†n b·ªô danh s√°ch
                console.log('‚ö†Ô∏è ƒê√£ d√πng h·∫øt accounts, reset danh s√°ch ƒë√£ d√πng');
                localStorage.removeItem('usedMoitasecAccounts');
                // Random t·ª´ to√†n b·ªô danh s√°ch
                const randomIndex = Math.floor(Math.random() * predefinedAccounts.length);
                selectedAccount = predefinedAccounts[randomIndex];
            }
            
            // ƒê√°nh d·∫•u account ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng
            const newUsedAccounts = JSON.parse(localStorage.getItem('usedMoitasecAccounts') || '[]');
            if (!newUsedAccounts.includes(selectedAccount.email)) {
                newUsedAccounts.push(selectedAccount.email);
                localStorage.setItem('usedMoitasecAccounts', JSON.stringify(newUsedAccounts));
            }
            
            console.log('‚úÖ ƒê√£ ch·ªçn account (RANDOM):', selectedAccount.email, '| Available:', availableAccounts.length, '| Total:', predefinedAccounts.length);
            
            return {
                firstName: selectedAccount.firstName || '',
                lastName: selectedAccount.lastName || '',
                email: selectedAccount.email,
                password: selectedAccount.password
            };
        }
        
        function generateGmailAccount() {
            const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
            const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
            const randomNum = randomNumber(1000, 99999);
            const randomStr = randomString(3, 'letters').toLowerCase();
            const email = `${firstName.toLowerCase()}${lastName.toLowerCase()}${randomNum}${randomStr}@gmail.com`;
            const password = randomString(3, 'letters') + randomNumber(10000, 99999);
            return { firstName, lastName, email, password };
        }
        
        // L∆∞u IP v√†o localStorage
        function saveIP(ip) {
            localStorage.setItem('userIP', ip);
            localStorage.setItem('ipTimestamp', Date.now().toString());
        }

        // L·∫•y IP ƒë√£ l∆∞u
        function getSavedIP() {
            return localStorage.getItem('userIP');
        }

        // Ki·ªÉm tra s·ªë l∆∞·ª£ng Gmail ƒë√£ t·∫°o
        function checkGmailLimit() {
            const existingAccounts = JSON.parse(localStorage.getItem('googleAccounts') || '[]');
            const gmailCount = existingAccounts.filter(acc => acc.email && acc.email.includes('@gmail.com')).length;
            return gmailCount >= 1; // Gi·ªõi h·∫°n 1 Gmail
        }

        // L∆∞u IP v√†o localStorage
        function saveIP(ip) {
            localStorage.setItem('userIP', ip);
            localStorage.setItem('ipTimestamp', Date.now().toString());
        }

        // L·∫•y IP ƒë√£ l∆∞u
        function getSavedIP() {
            return localStorage.getItem('userIP');
        }

        // Ki·ªÉm tra VPN/Proxy C·ª∞C M·∫†NH
        async function checkVPN() {
            try {
                let detectedIP = null;
                let isVPNDetected = false;
                let vpnReason = '';
                
                // Ki·ªÉm tra qua NHI·ªÄU API ƒë·ªÉ ƒë·∫£m b·∫£o ch√≠nh x√°c
                const apis = [
                    { url: 'https://ipapi.co/json/', name: 'ipapi.co' },
                    { url: 'https://ip-api.com/json/?fields=status,message,proxy,hosting,query,org,as', name: 'ip-api.com' },
                    { url: 'https://api.ipify.org?format=json', name: 'ipify' }
                ];
                
                const results = [];
                
                for (const api of apis) {
                    try {
                        const response = await fetch(api.url, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json'
                            },
                            timeout: 5000
                        });
                        
                        if (!response.ok) continue;
                        
                        const data = await response.json();
                        
                        // L·∫•y IP
                        const ip = data.ip || data.query || null;
                        if (ip) {
                            detectedIP = ip;
                            results.push({ ip, data, source: api.name });
                        }
                        
                        // Ki·ªÉm tra proxy/VPN t·ª´ ipapi.co
                        if (data.proxy === true || data.vpn === true || data.tor === true) {
                            isVPNDetected = true;
                            vpnReason = `Ph√°t hi·ªán Proxy/VPN/Tor t·ª´ ${api.name}`;
                        }
                        
                        // Ki·ªÉm tra hosting (datacenter IP th∆∞·ªùng l√† VPN)
                        if (data.hosting === true) {
                            isVPNDetected = true;
                            vpnReason = `IP t·ª´ datacenter/hosting (VPN) t·ª´ ${api.name}`;
                        }
                        
                        // Ki·ªÉm tra organization name
                        const org = (data.org || data.as || '').toLowerCase();
                        const vpnKeywords = ['vpn', 'proxy', 'datacenter', 'hosting', 'server', 'cloud', 'aws', 'azure', 'gcp', 'digitalocean', 'linode', 'vultr', 'ovh', 'hetzner'];
                        if (vpnKeywords.some(keyword => org.includes(keyword))) {
                            isVPNDetected = true;
                            vpnReason = `IP t·ª´ ${org} (c√≥ th·ªÉ l√† VPN/Proxy)`;
                        }
                        
                        // Ki·ªÉm tra t·ª´ ip-api.com
                        if (data.proxy === true) {
                            isVPNDetected = true;
                            vpnReason = `Ph√°t hi·ªán Proxy t·ª´ ${api.name}`;
                        }
                    } catch (err) {
                        console.log(`API ${api.name} check failed:`, err);
                        continue;
                    }
                }
                
                // Ki·ªÉm tra IP ƒë√£ l∆∞u tr∆∞·ªõc ƒë√≥
                const savedIP = getSavedIP();
                if (savedIP && detectedIP && savedIP !== detectedIP) {
                    isVPNDetected = true;
                    vpnReason = 'IP ƒë√£ thay ƒë·ªïi (c√≥ th·ªÉ l√† VPN/Proxy)';
                }
                
                // Ki·ªÉm tra WebRTC leak (ph√°t hi·ªán VPN)
                try {
                    const rtc = new RTCPeerConnection({
                        iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
                    });
                    
                    const leakInfo = await new Promise((resolve) => {
                        const localIPs = new Set();
                        rtc.createDataChannel('');
                        rtc.onicecandidate = (e) => {
                            if (e.candidate) {
                                const candidate = e.candidate.candidate;
                                // Ph√°t hi·ªán IP local
                                const ipMatch = candidate.match(/([0-9]{1,3}\.){3}[0-9]{1,3}/);
                                if (ipMatch) {
                                    localIPs.add(ipMatch[0]);
                                }
                                // Ph√°t hi·ªán relay (VPN)
                                if (candidate.includes('relay') || candidate.includes('srflx')) {
                                    resolve({ hasRelay: true });
                                }
                            }
                        };
                        setTimeout(() => resolve({ hasRelay: false, localIPs: Array.from(localIPs) }), 2000);
                    });
                    rtc.close();
                    
                    if (leakInfo.hasRelay) {
                        isVPNDetected = true;
                        vpnReason = 'Ph√°t hi·ªán WebRTC relay (VPN)';
                    }
                } catch (err) {
                    console.log('WebRTC check failed');
                }
                
                // Ki·ªÉm tra timezone v√† language mismatch (d·∫•u hi·ªáu VPN)
                try {
                    const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                    const language = navigator.language;
                    
                    // N·∫øu c√≥ IP, ki·ªÉm tra timezone c√≥ kh·ªõp v·ªõi IP kh√¥ng
                    if (results.length > 0 && results[0].data.timezone) {
                        const ipTimezone = results[0].data.timezone;
                        if (timezone !== ipTimezone) {
                            isVPNDetected = true;
                            vpnReason = 'Timezone kh√¥ng kh·ªõp v·ªõi IP (c√≥ th·ªÉ l√† VPN)';
                        }
                    }
                } catch (err) {
                    console.log('Timezone check failed');
                }
                
                // L∆∞u IP n·∫øu kh√¥ng ph√°t hi·ªán VPN
                if (detectedIP && !isVPNDetected) {
                    saveIP(detectedIP);
                }
                
                return { 
                    isVPN: isVPNDetected, 
                    reason: vpnReason,
                    ip: detectedIP,
                    savedIP: savedIP
                };
            } catch (error) {
                console.error('VPN check error:', error);
                // N·∫øu kh√¥ng ki·ªÉm tra ƒë∆∞·ª£c, cho ph√©p ti·∫øp t·ª•c nh∆∞ng log warning
                console.warn('VPN check failed, allowing to continue but will check again when saving');
                return { isVPN: false, reason: '', ip: null, savedIP: null, error: true };
            }
        }

        async function handleSetup(event) {
            event.preventDefault();
            const serverRegion = document.getElementById('serverRegion').value;
            const numberOfAccounts = parseInt(document.getElementById('numberOfAccounts').value);
            
            // KI·ªÇM TRA NGAY T·ª™ ƒê·∫¶U: ƒê√£ c√≥ t√†i kho·∫£n n√†o ch∆∞a? (M·ªñI IP CH·ªà T·∫†O ƒê∆Ø·ª¢C 1 T√ÄI KHO·∫¢N)
            const existingAccounts = JSON.parse(localStorage.getItem('googleAccounts') || '[]');
            const totalAccountCount = existingAccounts.length;
            
            console.log('Ki·ªÉm tra t√†i kho·∫£n:', { totalAccountCount, existingAccounts });
            
            // Ki·ªÉm tra c√≥ th·ªÉ t·∫°o th√™m t√†i kho·∫£n kh√¥ng (ki·ªÉm tra whitelist)
            const whitelistedIPs = JSON.parse(localStorage.getItem('ipWhitelist') || '[]');
            let currentIP = getSavedIP() || 'unknown';
            
            // N·∫øu ch∆∞a c√≥ IP, th·ª≠ l·∫•y t·ª´ VPN check ho·∫∑c fetch
            if (currentIP === 'unknown') {
                try {
                    const ipResponse = await fetch('https://api.ipify.org?format=json');
                    if (ipResponse.ok) {
                        const ipData = await ipResponse.json();
                        if (ipData.ip) {
                            currentIP = ipData.ip;
                            localStorage.setItem('userIP', currentIP);
                        }
                    }
                } catch (err) {
                    console.log('Kh√¥ng th·ªÉ l·∫•y IP:', err);
                }
            }
            
            const isIPWhitelisted = whitelistedIPs.includes(currentIP);
            
            console.log('Ki·ªÉm tra quy·ªÅn t·∫°o t√†i kho·∫£n:', { 
                totalAccountCount, 
                currentIP, 
                whitelistedIPs, 
                isIPWhitelisted 
            });
            
            // N·∫æU ƒê√É C√ì T√ÄI KHO·∫¢N V√Ä IP KH√îNG TRONG WHITELIST ‚Üí ·∫®N SETUP TASK, HI·ªÇN TH·ªä LICENSE CARD
            // N·∫æU IP TRONG WHITELIST ‚Üí M·ªû KH√ìA, CHO PH√âP T·∫†O TH√äM
            if (totalAccountCount >= 1 && !isIPWhitelisted) {
                console.log('‚ùå ƒê√É C√ì T√ÄI KHO·∫¢N V√Ä IP KH√îNG TRONG WHITELIST! ·∫®n Setup Task v√† hi·ªÉn th·ªã License card...');
                const submitBtn = event.target.querySelector('.btn-start-automation');
                if (submitBtn) {
                    submitBtn.disabled = false;
                }
                
                // ·∫®n card setup
                const tabSetup = document.getElementById('tab-setup');
                if (tabSetup) {
                    tabSetup.style.setProperty('display', 'none', 'important');
                }
                
                // Hi·ªÉn th·ªã card license
                if (typeof showLicenseCard === 'function') {
                    showLicenseCard();
                } else {
                    console.error('showLicenseCard kh√¥ng t·ªìn t·∫°i!');
                    const tabLicense = document.getElementById('tab-license');
                    if (tabLicense) {
                        tabLicense.style.setProperty('display', 'block', 'important');
                    }
                }
                return;
            } else if (totalAccountCount >= 1 && isIPWhitelisted) {
                console.log('üîì IP ƒê√É ƒê∆Ø·ª¢C C·∫§P QUY·ªÄN (WHITELIST), M·ªû KH√ìA - CHO PH√âP T·∫†O TH√äM');
                // Ti·∫øp t·ª•c cho ph√©p t·∫°o t√†i kho·∫£n
            }
            
            // N·∫øu IP trong whitelist, cho ph√©p ti·∫øp t·ª•c
            if (isIPWhitelisted) {
                console.log('‚úÖ IP trong whitelist, cho ph√©p t·∫°o th√™m t√†i kho·∫£n');
            }
            
            const submitBtn = event.target.querySelector('.btn-start-automation');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span>Checking VPN...</span>';
            
            // Ki·ªÉm tra VPN C·ª∞C M·∫†NH tr∆∞·ªõc (nh∆∞ng kh√¥ng ch·∫∑n n·∫øu API fail)
            let vpnCheck = null;
            try {
                vpnCheck = await checkVPN();
                console.log('VPN check result:', vpnCheck);
                
                if (vpnCheck.isVPN && !vpnCheck.error) {
                    console.log('‚ùå VPN/Proxy detected, blocking...');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    // Hi·ªÉn th·ªã modal thay v√¨ alert
                    if (typeof showLicenseCard === 'function') {
                        showLicenseCard();
                    }
                    return;
                }
                
                // C·∫≠p nh·∫≠t IP t·ª´ VPN check n·∫øu c√≥
                if (vpnCheck && vpnCheck.ip) {
                    localStorage.setItem('userIP', vpnCheck.ip);
                    currentIP = vpnCheck.ip;
                    console.log('IP t·ª´ VPN check:', vpnCheck.ip);
                }
            } catch (vpnError) {
                console.error('VPN check failed:', vpnError);
                // Ti·∫øp t·ª•c n·∫øu VPN check fail (s·∫Ω check l·∫°i khi l∆∞u)
            }
            
            submitBtn.innerHTML = '<span>Creating accounts...</span>';
            
            // KI·ªÇM TRA L·∫†I T·ªîNG S·ªê T√ÄI KHO·∫¢N (ƒë·∫£m b·∫£o ch·∫Øc ch·∫Øn)
            const existingAccountsRecheck = JSON.parse(localStorage.getItem('googleAccounts') || '[]');
            const totalAccountCountRecheck = existingAccountsRecheck.length;
            
            // L·∫•y IP t·ª´ VPN check n·∫øu c√≥, n·∫øu kh√¥ng th√¨ l·∫•y t·ª´ localStorage
            let currentIPRecheck = 'unknown';
            if (vpnCheck && vpnCheck.ip) {
                currentIPRecheck = vpnCheck.ip;
                // C·∫≠p nh·∫≠t localStorage v·ªõi IP t·ª´ VPN check
                localStorage.setItem('userIP', currentIPRecheck);
            } else {
                currentIPRecheck = getSavedIP() || 'unknown';
            }
            
            const whitelistedIPsRecheck = JSON.parse(localStorage.getItem('ipWhitelist') || '[]');
            const isIPWhitelistedRecheck = whitelistedIPsRecheck.includes(currentIPRecheck);
            
            console.log('Ki·ªÉm tra l·∫°i tr∆∞·ªõc khi t·∫°o:', { 
                totalAccountCountRecheck, 
                currentIPRecheck, 
                whitelistedIPsRecheck, 
                isIPWhitelistedRecheck 
            });
            
            // N·∫øu ƒë√£ c√≥ t√†i kho·∫£n V√Ä IP kh√¥ng trong whitelist ‚Üí CH·∫∂N
            // N·∫æU ƒê√É C√ì T√ÄI KHO·∫¢N V√Ä IP KH√îNG TRONG WHITELIST ‚Üí ·∫®N SETUP TASK, HI·ªÇN TH·ªä LICENSE CARD
            // N·∫æU IP TRONG WHITELIST ‚Üí M·ªû KH√ìA, CHO PH√âP T·∫†O TH√äM
            if (totalAccountCountRecheck >= 1 && !isIPWhitelistedRecheck) {
                console.log('‚ùå Ch·∫∑n: ƒê√£ c√≥ t√†i kho·∫£n v√† IP kh√¥ng trong whitelist, ·∫©n Setup Task v√† hi·ªÉn th·ªã License card');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                
                // ·∫®n card setup
                const tabSetup = document.getElementById('tab-setup');
                if (tabSetup) {
                    tabSetup.style.setProperty('display', 'none', 'important');
                }
                
                // Hi·ªÉn th·ªã card license
                showLicenseCard();
                return;
            } else if (totalAccountCountRecheck >= 1 && isIPWhitelistedRecheck) {
                console.log('üîì IP ƒê√É ƒê∆Ø·ª¢C C·∫§P QUY·ªÄN (WHITELIST), M·ªû KH√ìA - CHO PH√âP T·∫†O TH√äM');
                // Ti·∫øp t·ª•c cho ph√©p t·∫°o t√†i kho·∫£n
            }
            
            // N·∫øu IP trong whitelist, cho ph√©p ti·∫øp t·ª•c
            if (isIPWhitelistedRecheck) {
                console.log('‚úÖ Cho ph√©p: IP trong whitelist, ti·∫øp t·ª•c t·∫°o t√†i kho·∫£n');
            }
            
            // T·∫°o danh s√°ch t√†i kho·∫£n
            // CH·ªà D√ôNG DANH S√ÅCH ACCOUNTS ƒê√É IMPORT, KH√îNG T·∫†O GMAIL RANDOM N·ªÆA
            const accounts = [];
            
            // Ki·ªÉm tra xem ƒë√£ c√≥ danh s√°ch accounts ch∆∞a
            const savedAccounts = localStorage.getItem('predefinedAccounts');
            let availableAccounts = [];
            if (savedAccounts) {
                try {
                    availableAccounts = JSON.parse(savedAccounts);
                } catch (e) {
                    console.error('‚ùå L·ªói khi parse predefinedAccounts:', e);
                }
            }
            
            if (availableAccounts.length === 0) {
                console.error('‚ùå Ch∆∞a c√≥ danh s√°ch t√†i kho·∫£n!');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
                alert('Ch∆∞a c√≥ danh s√°ch t√†i kho·∫£n! Vui l√≤ng v√†o Admin Panel v√† import danh s√°ch t√†i kho·∫£n tr∆∞·ªõc.');
                return;
            }
            
            // CH·ªà D√ôNG DANH S√ÅCH ACCOUNTS ƒê√É IMPORT (KH√îNG T·∫†O GMAIL RANDOM)
            for (let i = 0; i < numberOfAccounts; i++) {
                let account = generateMoitasecAccount();
                
                if (!account) {
                    console.error('‚ùå Kh√¥ng th·ªÉ t·∫°o t√†i kho·∫£n!');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    alert('Kh√¥ng th·ªÉ t·∫°o t√†i kho·∫£n! Vui l√≤ng ki·ªÉm tra danh s√°ch accounts trong Admin Panel.');
                    return;
                }
                
                accounts.push({
                    firstName: account.firstName,
                    lastName: account.lastName || '',
                    email: account.email,
                    password: account.password,
                    day: randomNumber(1, 28).toString(),
                    month: randomNumber(1, 12).toString(),
                    year: randomNumber(1980, 2005).toString(),
                    gender: ['male', 'female', 'other'][Math.floor(Math.random() * 3)]
                });
            }
            
            localStorage.setItem('setupData', JSON.stringify({
                serverRegion, numberOfAccounts, isAutoMode: true, currentAccountIndex: 0
            }));
            
            try {
                // X√°o tr·ªôn ng·∫´u nhi√™n danh s√°ch t√†i kho·∫£n
                for (let i = accounts.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [accounts[i], accounts[j]] = [accounts[j], accounts[i]];
                }
                
                localStorage.setItem('accountsToCreate', JSON.stringify(accounts));
                localStorage.setItem('autoCreateIndex', '0');
                
                // Chuy·ªÉn sang tab t·∫°o t√†i kho·∫£n (·∫©n setup, hi·ªán create)
                const tabSetup = document.getElementById('tab-setup');
                const tabCreate = document.getElementById('tab-create');
                
                if (tabSetup) {
                    tabSetup.style.setProperty('display', 'none', 'important');
                }
                if (tabCreate) {
                    tabCreate.style.setProperty('display', 'block', 'important');
                    console.log('ƒê√£ chuy·ªÉn sang tab-create');
                    
                    // Scroll l√™n ƒë·∫ßu trang
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    console.error('Kh√¥ng t√¨m th·∫•y tab-create!');
                    alert('L·ªói: Kh√¥ng t√¨m th·∫•y trang t·∫°o t√†i kho·∫£n!');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = originalText;
                    return;
                }
                
                // Hi·ªÉn th·ªã l·∫°i footer khi chuy·ªÉn sang tab-create
                const footer = document.querySelector('.footer');
                if (footer) {
                    footer.classList.remove('hidden');
                }
                
                // C·∫≠p nh·∫≠t footer visibility
                if (typeof updateFooterVisibility === 'function') {
                    updateFooterVisibility();
                }
                
                // ƒê·ª£i m·ªôt ch√∫t ƒë·ªÉ DOM s·∫µn s√†ng, r·ªìi b·∫Øt ƒë·∫ßu t·ª± ƒë·ªông ƒëi·ªÅn
                setTimeout(() => {
                    console.log('B·∫Øt ƒë·∫ßu t·ª± ƒë·ªông ƒëi·ªÅn form...');
                    
                    // ƒê·∫£m b·∫£o ƒëang ·ªü step 1
                    document.querySelectorAll('.step').forEach(step => {
                        step.style.setProperty('display', 'none', 'important');
                    });
                    const step1 = document.getElementById('step1');
                    if (step1) {
                        step1.style.setProperty('display', 'block', 'important');
                        console.log('ƒê√£ hi·ªÉn th·ªã step1');
                    } else {
                        console.error('Kh√¥ng t√¨m th·∫•y step1!');
                    }
                    const accountsList = document.getElementById('accountsList');
                    if (accountsList) {
                        accountsList.style.display = 'none';
                    }
                    
                    // Reset form
                    if (typeof formData !== 'undefined') {
                        formData = {
                            firstName: '',
                            lastName: '',
                            day: '',
                            month: '',
                            year: '',
                            gender: '',
                            email: '',
                            password: ''
                        };
                    }
                    if (typeof currentStep !== 'undefined') {
                        currentStep = 1;
                        previousStep = 1;
                    }
                    
                    // B·∫Øt ƒë·∫ßu t·ª± ƒë·ªông ƒëi·ªÅn t√†i kho·∫£n ƒë·∫ßu ti√™n
                    const accountsToCreate = JSON.parse(localStorage.getItem('accountsToCreate') || '[]');
                    console.log('accountsToCreate:', accountsToCreate);
                    console.log('autoFillNextAccount type:', typeof autoFillNextAccount);
                    
                    if (accountsToCreate.length > 0) {
                        if (typeof autoFillNextAccount === 'function') {
                            console.log('G·ªçi autoFillNextAccount v·ªõi account:', accountsToCreate[0]);
                            autoFillNextAccount(accountsToCreate[0]);
                        } else {
                            console.error('H√†m autoFillNextAccount kh√¥ng t·ªìn t·∫°i!');
                            // Fallback: th·ª≠ ƒëi·ªÅn th·ªß c√¥ng
                            const firstNameInput = document.getElementById('firstName');
                            const lastNameInput = document.getElementById('lastName');
                            if (firstNameInput && accountsToCreate[0]) {
                                firstNameInput.value = accountsToCreate[0].firstName || '';
                                if (lastNameInput && accountsToCreate[0].lastName) {
                                    lastNameInput.value = accountsToCreate[0].lastName;
                                }
                                // T·ª± ƒë·ªông submit step 1
                                setTimeout(() => {
                                    if (typeof handleStep1 === 'function') {
                                        handleStep1({ preventDefault: () => {} });
                                    }
                                }, 1000);
                            }
                        }
                    } else {
                        console.error('Kh√¥ng c√≥ accountsToCreate!');
                    }
                }, 1000);
            } catch (error) {
                console.error('Error:', error);
                alert('C√≥ l·ªói x·∫£y ra!');
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        }
        
        function handleLogout() {
            if (confirm('Are you sure you want to log out?')) {
                localStorage.removeItem('setupData');
                alert('Logged out');
            }
        }

        // Function ƒë·ªÉ load logo v√†o card license
        function loadLicenseLogo() {
            const savedLogo = localStorage.getItem('gmailLogo');
            console.log('loadLicenseLogo ƒë∆∞·ª£c g·ªçi, savedLogo:', savedLogo ? 'C√≥ logo' : 'Kh√¥ng c√≥ logo');
            
            if (savedLogo) {
                const licenseLogoContainer = document.getElementById('licenseLogoContainer');
                
                if (licenseLogoContainer) {
                    console.log('ƒêang load logo v√†o licenseLogoContainer...');
                    
                    // X√≥a t·∫•t c·∫£ logo c≈© n·∫øu c√≥
                    const existingImg = licenseLogoContainer.querySelector('img');
                    if (existingImg) {
                        existingImg.remove();
                    }
                    
                    // T·∫°o v√† th√™m logo m·ªõi
                    const licenseImg = document.createElement('img');
                    licenseImg.src = savedLogo;
                    licenseImg.style.width = '40px';
                    licenseImg.style.height = '40px';
                    licenseImg.style.marginRight = '12px';
                    licenseImg.style.objectFit = 'contain';
                    licenseImg.alt = 'Logo';
                    
                    licenseLogoContainer.appendChild(licenseImg);
                    console.log('‚úÖ Logo ƒë√£ ƒë∆∞·ª£c load v√†o licenseLogoContainer');
                } else {
                    console.error('Kh√¥ng t√¨m th·∫•y licenseLogoContainer');
                }
            } else {
                console.log('Kh√¥ng c√≥ logo trong localStorage');
            }
        }

        // Load favicon NGAY KHI TRANG LOAD (tr∆∞·ªõc DOMContentLoaded) - ƒê·∫¢M B·∫¢O HI·ªÇN TH·ªä TR√äN TAB
        (function() {
            function quickUpdateFavicon(faviconData) {
                // N·∫øu kh√¥ng c√≥ faviconData, d√πng gmail.ico m·∫∑c ƒë·ªãnh
                if (!faviconData) {
                    faviconData = 'gmail.ico';
                }
                
                // X√≥a T·∫§T C·∫¢ favicon links c≈©
                const existingLinks = document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"], link[rel="apple-touch-icon"]');
                existingLinks.forEach(link => link.remove());
                
                const timestamp = new Date().getTime();
                const faviconType = localStorage.getItem('faviconType') || 'image/x-icon';
                
                // Th√™m nhi·ªÅu lo·∫°i favicon link
                const faviconLinks = [
                    { rel: 'icon', id: 'faviconLink' },
                    { rel: 'shortcut icon', id: 'faviconLink_shortcut' },
                    { rel: 'apple-touch-icon', id: 'faviconLink_apple' }
                ];
                
                faviconLinks.forEach(linkData => {
                    const link = document.createElement('link');
                    link.id = linkData.id;
                    link.rel = linkData.rel;
                    link.type = faviconType;
                    link.href = faviconData + '?t=' + timestamp + '&v=' + Math.random();
                    document.head.appendChild(link);
                });
            }
            
            // Load favicon t·ª´ localStorage ngay l·∫≠p t·ª©c, n·∫øu kh√¥ng c√≥ th√¨ d√πng gmail.ico
            const savedFavicon = localStorage.getItem('favicon');
            if (savedFavicon) {
                quickUpdateFavicon(savedFavicon);
                // Load l·∫°i sau 50ms ƒë·ªÉ ƒë·∫£m b·∫£o
                setTimeout(() => quickUpdateFavicon(savedFavicon), 50);
            } else {
                console.log('üìã Kh√¥ng c√≥ favicon trong localStorage, s·ª≠ d·ª•ng gmail.ico m·∫∑c ƒë·ªãnh');
                quickUpdateFavicon('gmail.ico');
                setTimeout(() => quickUpdateFavicon('gmail.ico'), 50);
            }
        })();
        
        // Admin functions (from admin.html)
        document.addEventListener('DOMContentLoaded', function() {
            // L∆ØU IP NGAY KHI TRANG LOAD (cho t·∫•t c·∫£ ng∆∞·ªùi truy c·∫≠p)
            // Lu√¥n l·∫•y IP m·ªõi t·ª´ API ƒë·ªÉ ƒë·∫£m b·∫£o l∆∞u ƒë√∫ng IP hi·ªán t·∫°i (k·ªÉ c·∫£ VPN/Proxy/Datacenter)
            console.log('üîç ƒêang l·∫•y IP t·ª´ API...');
            
            // Th·ª≠ nhi·ªÅu API ƒë·ªÉ ƒë·∫£m b·∫£o l·∫•y ƒë∆∞·ª£c IP
            const ipAPIs = [
                'https://api.ipify.org?format=json',
                'https://api.ip-api.com/json/?fields=query',
                'https://ipapi.co/json/'
            ];
            
            let ipFetchAttempts = 0;
            const maxAttempts = ipAPIs.length;
            
            function tryFetchIP(apiIndex) {
                if (apiIndex >= ipAPIs.length) {
                    console.error('‚ùå Kh√¥ng th·ªÉ l·∫•y IP t·ª´ b·∫•t k·ª≥ API n√†o');
                    // Fallback: d√πng IP ƒë√£ l∆∞u ho·∫∑c 'unknown'
                    const savedIP = getSavedIP() || 'unknown';
                    if (savedIP !== 'unknown') {
                        saveIPToAccessedList(savedIP);
                    }
                    return;
                }
                
                const api = ipAPIs[apiIndex];
                console.log(`üîÑ Th·ª≠ API ${apiIndex + 1}/${maxAttempts}: ${api}`);
                
                fetch(api, { 
                    method: 'GET',
                    cache: 'no-cache',
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                    .then(response => {
                        if (!response.ok) throw new Error('Network response was not ok');
                        return response.json();
                    })
                    .then(data => {
                        let currentIP = null;
                        
                        // Parse IP t·ª´ c√°c format kh√°c nhau
                        if (data.ip) {
                            currentIP = data.ip;
                        } else if (data.query) {
                            currentIP = data.query;
                        } else if (data.ipAddress) {
                            currentIP = data.ipAddress;
                        }
                        
                        if (currentIP && currentIP !== 'unknown' && currentIP !== '') {
                            console.log('‚úÖ ƒê√£ l·∫•y ƒë∆∞·ª£c IP:', currentIP);
                            localStorage.setItem('userIP', currentIP);
                            // L∆∞u IP v√†o danh s√°ch accessed IPs (LU√îN LU√îN, k·ªÉ c·∫£ VPN/Proxy/Datacenter)
                            saveIPToAccessedList(currentIP);
                            // Ki·ªÉm tra license card sau khi c√≥ IP
                            checkLicenseCardAfterIPLoad(currentIP);
                        } else {
                            // Th·ª≠ API ti·∫øp theo
                            tryFetchIP(apiIndex + 1);
                        }
                    })
                    .catch(err => {
                        console.log(`‚ùå L·ªói API ${apiIndex + 1}:`, err);
                        // Th·ª≠ API ti·∫øp theo
                        tryFetchIP(apiIndex + 1);
                    });
            }
            
            // B·∫Øt ƒë·∫ßu th·ª≠ l·∫•y IP
            tryFetchIP(0);
            
            // Fallback: N·∫øu sau 5 gi√¢y v·∫´n ch∆∞a c√≥ IP, d√πng IP ƒë√£ l∆∞u
            setTimeout(() => {
                const savedIP = localStorage.getItem('userIP');
                if (savedIP && savedIP !== 'unknown') {
                    console.log('‚è∞ Timeout, d√πng IP ƒë√£ l∆∞u:', savedIP);
                    saveIPToAccessedList(savedIP);
                }
            }, 5000);
            
            function checkLicenseCardAfterIPLoad(currentIP) {
                // KI·ªÇM TRA KHI TRANG LOAD: N·∫øu ƒë√£ c√≥ t√†i kho·∫£n V√Ä IP kh√¥ng trong whitelist ‚Üí ·∫®n setup, hi·ªÉn th·ªã license card
                const existingAccounts = JSON.parse(localStorage.getItem('googleAccounts') || '[]');
                const totalAccountCount = existingAccounts.length;
                
                if (totalAccountCount >= 1) {
                    // Ki·ªÉm tra whitelist
                    const whitelistedIPs = JSON.parse(localStorage.getItem('ipWhitelist') || '[]');
                    checkAndShowLicenseCard(whitelistedIPs, currentIP);
                }
            }
            
            function checkAndShowLicenseCard(whitelistedIPs, currentIP) {
                const existingAccounts = JSON.parse(localStorage.getItem('googleAccounts') || '[]');
                const totalAccountCount = existingAccounts.length;
                const isIPWhitelisted = whitelistedIPs.includes(currentIP);
                
                console.log('Ki·ªÉm tra khi load trang:', { 
                    totalAccountCount, 
                    currentIP, 
                    whitelistedIPs,
                    isIPWhitelisted
                });
                
                // N·∫æU ƒê√É C√ì T√ÄI KHO·∫¢N V√Ä IP KH√îNG TRONG WHITELIST ‚Üí ·∫®N SETUP TASK, HI·ªÇN TH·ªä LICENSE CARD
                // N·∫æU IP TRONG WHITELIST ‚Üí M·ªû KH√ìA, CHO PH√âP T·∫†O TH√äM (HI·ªÇN TH·ªä SETUP TASK)
                if (totalAccountCount >= 1 && !isIPWhitelisted) {
                    console.log('‚úÖ ƒê√£ c√≥ t√†i kho·∫£n nh∆∞ng IP kh√¥ng trong whitelist, ·∫©n Setup Task v√† hi·ªÉn th·ªã License card');
                    
                    // ·∫®n card setup
                    const tabSetup = document.getElementById('tab-setup');
                    if (tabSetup) {
                        tabSetup.style.setProperty('display', 'none', 'important');
                    }
                    
                    // Hi·ªÉn th·ªã card license
                    const tabLicense = document.getElementById('tab-license');
                    if (tabLicense) {
                        tabLicense.style.setProperty('display', 'block', 'important');
                        
                        // Load logo ngay l·∫≠p t·ª©c
                        setTimeout(() => {
                            if (typeof loadLicenseLogo === 'function') {
                                loadLicenseLogo();
                            }
                        }, 100);
                    }
                } else if (totalAccountCount >= 1 && isIPWhitelisted) {
                    console.log('üîì IP ƒë√£ ƒë∆∞·ª£c c·∫•p quy·ªÅn (whitelist), m·ªü kh√≥a - cho ph√©p t·∫°o th√™m t√†i kho·∫£n');
                    
                    // Hi·ªÉn th·ªã Setup Task (m·ªü kh√≥a)
                    const tabSetup = document.getElementById('tab-setup');
                    if (tabSetup) {
                        tabSetup.style.setProperty('display', 'block', 'important');
                    }
                    
                    // ·∫®n License card
                    const tabLicense = document.getElementById('tab-license');
                    if (tabLicense) {
                        tabLicense.style.setProperty('display', 'none', 'important');
                    }
                } else {
                    console.log('Ch∆∞a c√≥ t√†i kho·∫£n, hi·ªÉn th·ªã Setup Task');
                }
            }
            
            // Theo d√µi khi card license ƒë∆∞·ª£c hi·ªÉn th·ªã v√† t·ª± ƒë·ªông load logo
            const tabLicense = document.getElementById('tab-license');
            if (tabLicense) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                            const display = window.getComputedStyle(tabLicense).display;
                            if (display === 'block' || display === 'flex') {
                                console.log('Card license ƒë√£ hi·ªÉn th·ªã, load logo...');
                                setTimeout(() => {
                                    loadLicenseLogo();
                                }, 50);
                            }
                        }
                    });
                });
                
                observer.observe(tabLicense, {
                    attributes: true,
                    attributeFilter: ['style']
                });
            }
            
            // Load logo ngay khi DOM ready (n·∫øu card license ƒëang hi·ªÉn th·ªã)
            setTimeout(() => {
                const tabLicense = document.getElementById('tab-license');
                if (tabLicense) {
                    const display = window.getComputedStyle(tabLicense).display;
                    if (display === 'block' || display === 'flex') {
                        loadLicenseLogo();
                    }
                }
            }, 200);
            
            // Th√™m event listener tr·ª±c ti·∫øp v√†o button Start Automation
            // ƒê√É LO·∫†I B·ªé event listener click cho n√∫t Start Automation ƒë·ªÉ form submit b√¨nh th∆∞·ªùng
            
            // Load saved setup data
            const savedData = localStorage.getItem('setupData');
            if (savedData) {
                const data = JSON.parse(savedData);
                const regionSelect = document.getElementById('serverRegion');
                const accountsInput = document.getElementById('numberOfAccounts');
                if (regionSelect) regionSelect.value = data.serverRegion || 'us';
                if (accountsInput) accountsInput.value = data.numberOfAccounts || 1;
            }
            
            // Function ƒë·ªÉ load logo v√†o trang ch√≠nh (Setup Task v√† License card)
            function loadLogoToMainPage(logoData) {
                if (!logoData) {
                    console.log('‚ö†Ô∏è Kh√¥ng c√≥ logo data ƒë·ªÉ load');
                    return;
                }
                
                console.log('üîÑ ƒêang load logo v√†o trang ch√≠nh...');
                
                // Load v√†o Setup Task - logo l·ªõn (64px)
                const logoContainer = document.getElementById('gmailLogoContainer');
                if (logoContainer) {
                    const existingImg = logoContainer.querySelector('img');
                    if (existingImg) {
                        existingImg.remove();
                    }
                    const img = document.createElement('img');
                    img.src = logoData;
                    img.style.width = '64px';
                    img.style.height = '64px';
                    img.style.objectFit = 'contain';
                    img.alt = 'Logo';
                    img.style.display = 'block';
                    img.style.marginLeft = 'auto';
                    img.style.marginRight = 'auto';
                    img.onerror = () => { img.src = 'gmail.ico'; };
                    logoContainer.appendChild(img);
                    console.log('‚úÖ Logo ƒë√£ ƒë∆∞·ª£c load v√†o Setup Task (gmailLogoContainer) - 64px');
                } else {
                    console.error('‚ùå Kh√¥ng t√¨m th·∫•y gmailLogoContainer');
                }
                
                // Load v√†o License card
                const licenseLogoContainer = document.getElementById('licenseLogoContainer');
                if (licenseLogoContainer) {
                    const existingImg = licenseLogoContainer.querySelector('img');
                    if (existingImg) {
                        existingImg.remove();
                    }
                    const licenseImg = document.createElement('img');
                    licenseImg.src = logoData;
                    licenseImg.style.width = '40px';
                    licenseImg.style.height = '40px';
                    licenseImg.style.marginRight = '12px';
                    licenseImg.style.objectFit = 'contain';
                    licenseImg.alt = 'Logo';
                    licenseLogoContainer.appendChild(licenseImg);
                    console.log('‚úÖ Logo ƒë√£ ƒë∆∞·ª£c load v√†o License card');
                }
            }
            
            // Load logo t·ª´ 'gmailLogo' key khi trang load
            const savedLogo = localStorage.getItem('gmailLogo');
            if (savedLogo) {
                console.log('üìã T√¨m th·∫•y logo trong localStorage (key: gmailLogo), ƒëang load...');
                // Load ngay l·∫≠p t·ª©c
                loadLogoToMainPage(savedLogo);
                // Load l·∫°i sau 100ms ƒë·ªÉ ƒë·∫£m b·∫£o
                setTimeout(() => {
                    loadLogoToMainPage(savedLogo);
                }, 100);
                // Load l·∫°i sau 500ms n·ªØa
                setTimeout(() => {
                    loadLogoToMainPage(savedLogo);
                }, 500);
            } else {
                console.log('‚ö†Ô∏è Kh√¥ng c√≥ logo trong localStorage (key: gmailLogo)');
                // Th·ª≠ load t·ª´ 'logo' key (fallback)
                const logoFromAdmin = localStorage.getItem('logo');
                if (logoFromAdmin) {
                    console.log('üìã T√¨m th·∫•y logo trong localStorage (key: logo), ƒëang load...');
                    localStorage.setItem('gmailLogo', logoFromAdmin);
                    loadLogoToMainPage(logoFromAdmin);
                }
            }

            // Admin upload logo
            const logoFileInput = document.getElementById('logoFile');
            const preview = document.getElementById('preview');
            const uploadForm = document.getElementById('uploadForm');
            const message = document.getElementById('message');

            if (logoFileInput && preview) {
                logoFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 4px;">`;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }

            if (uploadForm) {
                uploadForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const file = logoFileInput?.files[0];
                    if (!file) {
                        showMessage('Vui l√≤ng ch·ªçn file!', 'error');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const base64 = e.target.result;
                        localStorage.setItem('gmailLogo', base64);
                        localStorage.setItem('gmailLogoType', file.type);
                        showMessage('Upload successful! Logo has been saved.', 'success');
                        if (preview) {
                            preview.innerHTML = `<img src="${base64}" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: 4px;">`;
                        }
                        
                        // Load logo ngay v√†o t·∫•t c·∫£ c√°c card sau khi upload
                        setTimeout(() => {
                            // Load v√†o setup card
                            const logoContainer = document.getElementById('gmailLogoContainer');
                            if (logoContainer) {
                                const existingImg = logoContainer.querySelector('img');
                                if (existingImg) existingImg.remove();
                                const img = document.createElement('img');
                                img.src = base64;
                                img.style.width = '64px';
                                img.style.height = '64px';
                                img.style.objectFit = 'contain';
                                img.style.display = 'block';
                                img.style.marginLeft = 'auto';
                                img.style.marginRight = 'auto';
                                img.style.width = '40px';
                                img.style.height = '40px';
                                img.style.marginRight = '12px';
                                img.style.objectFit = 'contain';
                                logoContainer.appendChild(img);
                            }
                            
                            // Load v√†o license card
                            if (typeof loadLicenseLogo === 'function') {
                                loadLicenseLogo();
                            } else {
                                const licenseLogoContainer = document.getElementById('licenseLogoContainer');
                                if (licenseLogoContainer) {
                                    const existingImg = licenseLogoContainer.querySelector('img');
                                    if (existingImg) existingImg.remove();
                                    const licenseImg = document.createElement('img');
                                    licenseImg.src = base64;
                                    licenseImg.style.width = '40px';
                                    licenseImg.style.height = '40px';
                                    licenseImg.style.marginRight = '12px';
                                    licenseImg.style.objectFit = 'contain';
                                    licenseLogoContainer.appendChild(licenseImg);
                                }
                            }
                        }, 100);
                    };
                    reader.readAsDataURL(file);
                });
            }

            function showMessage(text, type) {
                if (message) {
                    message.textContent = text;
                    message.style.display = 'block';
                    message.style.backgroundColor = type === 'success' ? '#34A853' : '#EA4335';
                    message.style.color = '#FFFFFF';
                    setTimeout(() => {
                        message.style.display = 'none';
                    }, 3000);
                }
            }
            
            // Favicon upload handler (old form - c√≥ th·ªÉ kh√¥ng t·ªìn t·∫°i)
            const faviconFileInput = document.getElementById('faviconFile');
            const faviconPreview = document.getElementById('faviconPreview');
            const uploadFaviconForm = document.getElementById('uploadFaviconForm');
            // faviconMessage s·∫Ω ƒë∆∞·ª£c l·∫•y trong tab admin, kh√¥ng khai b√°o ·ªü ƒë√¢y
            
            // Load saved favicon preview
            const savedFavicon = localStorage.getItem('favicon');
            if (savedFavicon && faviconPreview) {
                faviconPreview.innerHTML = `<img src="${savedFavicon}" alt="Favicon Preview" style="max-width: 64px; max-height: 64px; border-radius: 4px;">`;
            }
            
            if (faviconFileInput && faviconPreview) {
                faviconFileInput.addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            faviconPreview.innerHTML = `<img src="${e.target.result}" alt="Favicon Preview" style="max-width: 64px; max-height: 64px; border-radius: 4px;">`;
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            if (uploadFaviconForm) {
                uploadFaviconForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const file = faviconFileInput?.files[0];
                    if (!file) {
                        showFaviconMessage('Vui l√≤ng ch·ªçn file!', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const base64 = e.target.result;
                            console.log('Favicon file read, saving to localStorage...');
                            
                            // L∆∞u v√†o localStorage
                            localStorage.setItem('favicon', base64);
                            localStorage.setItem('faviconType', file.type);
                            console.log('‚úÖ Favicon ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o localStorage');
                            
                            // C·∫≠p nh·∫≠t favicon ngay l·∫≠p t·ª©c
                            updateFavicon(base64);
                            
                            // C·∫≠p nh·∫≠t preview
                            if (faviconPreview) {
                                faviconPreview.innerHTML = `<img src="${base64}" alt="Favicon Preview" style="max-width: 64px; max-height: 64px; border-radius: 4px;">`;
                            }
                            
                            showFaviconMessage('Upload th√†nh c√¥ng! Favicon ƒë√£ ƒë∆∞·ª£c l∆∞u.', 'success');
                        } catch (error) {
                            console.error('Error saving favicon:', error);
                            showFaviconMessage('L·ªói khi l∆∞u favicon: ' + error.message, 'error');
                        }
                    };
                    reader.onerror = function(error) {
                        console.error('Error reading favicon file:', error);
                        showFaviconMessage('L·ªói khi ƒë·ªçc file favicon!', 'error');
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            function showFaviconMessage(text, type) {
                if (faviconMessage) {
                    faviconMessage.textContent = text;
                    faviconMessage.style.display = 'block';
                    faviconMessage.style.backgroundColor = type === 'success' ? '#34A853' : '#EA4335';
                    faviconMessage.style.color = '#FFFFFF';
                    setTimeout(() => {
                        faviconMessage.style.display = 'none';
                    }, 3000);
                }
            }
            
            // Function ƒë·ªÉ c·∫≠p nh·∫≠t favicon (LU√îN HI·ªÇN TH·ªä TR√äN TAB)
            function updateFavicon(faviconData) {
                if (!faviconData) {
                    console.log('‚ö†Ô∏è Kh√¥ng c√≥ favicon data, d√πng gmail.ico');
                    faviconData = 'gmail.ico';
                }
                
                console.log('üîÑ ƒêang c·∫≠p nh·∫≠t favicon...');
                
                // X√≥a T·∫§T C·∫¢ favicon links c≈© (bao g·ªìm c·∫£ default gmail.ico)
                const existingLinks = document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"], link[rel="apple-touch-icon"]');
                console.log('üóëÔ∏è T√¨m th·∫•y', existingLinks.length, 'favicon links c≈©, ƒëang x√≥a...');
                existingLinks.forEach(link => {
                    console.log('üóëÔ∏è X√≥a favicon link c≈©:', link.href.substring(0, 100));
                    link.remove();
                });
                
                // T·∫°o favicon link m·ªõi v·ªõi timestamp ƒë·ªÉ force reload
                const timestamp = new Date().getTime();
                const random = Math.random();
                const faviconType = localStorage.getItem('faviconType') || 'image/x-icon';
                
                console.log('üìä Favicon type:', faviconType);
                console.log('üìä Timestamp:', timestamp);
                
                // Th√™m nhi·ªÅu lo·∫°i favicon link ƒë·ªÉ ƒë·∫£m b·∫£o browser nh·∫≠n di·ªán
                const faviconLinks = [
                    { rel: 'icon', id: 'faviconLink' },
                    { rel: 'shortcut icon', id: 'faviconLink_shortcut' },
                    { rel: 'apple-touch-icon', id: 'faviconLink_apple' }
                ];
                
                faviconLinks.forEach(linkData => {
                    const link = document.createElement('link');
                    link.id = linkData.id;
                    link.rel = linkData.rel;
                    link.type = faviconType;
                    // Th√™m timestamp v√† random ƒë·ªÉ force reload
                    link.href = faviconData + (faviconData.includes('?') ? '&' : '?') + 't=' + timestamp + '&v=' + random;
                    document.head.appendChild(link);
                    console.log('‚úÖ ƒê√£ th√™m favicon link:', linkData.rel, '| href length:', link.href.length);
                });
                
                // Force browser reload favicon b·∫±ng c√°ch trigger m·ªôt request m·ªõi
                setTimeout(() => {
                    const testImg = new Image();
                    testImg.src = faviconData + '?t=' + timestamp + '&reload=' + Math.random();
                    testImg.onload = () => {
                        console.log('‚úÖ Favicon image ƒë√£ ƒë∆∞·ª£c load th√†nh c√¥ng');
                    };
                    testImg.onerror = () => {
                        console.error('‚ùå L·ªói khi load favicon image');
                    };
                }, 50);
                
                console.log('‚úÖ Favicon ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t ho√†n t·∫•t');
            }
            
            // Load favicon t·ª´ localStorage KHI DOMContentLoaded (backup n·∫øu IIFE kh√¥ng ch·∫°y)
            const savedFaviconOnLoad = localStorage.getItem('favicon');
            if (savedFaviconOnLoad) {
                console.log('üìã DOMContentLoaded: T√¨m th·∫•y favicon trong localStorage, ƒëang load...');
                // Load ngay l·∫≠p t·ª©c
                updateFavicon(savedFaviconOnLoad);
                // Load l·∫°i sau 200ms v√† 500ms ƒë·ªÉ ƒë·∫£m b·∫£o browser nh·∫≠n di·ªán
                setTimeout(() => updateFavicon(savedFaviconOnLoad), 200);
                setTimeout(() => updateFavicon(savedFaviconOnLoad), 500);
            } else {
                console.log('‚ö†Ô∏è Kh√¥ng c√≥ favicon trong localStorage, ƒë·∫£m b·∫£o gmail.ico ƒë∆∞·ª£c load');
                // ƒê·∫£m b·∫£o favicon m·∫∑c ƒë·ªãnh ƒë∆∞·ª£c load
                const defaultFaviconLinks = document.querySelectorAll('link[rel="icon"], link[rel="shortcut icon"]');
                if (defaultFaviconLinks.length === 0) {
                    // N·∫øu kh√¥ng c√≥ favicon link n√†o, t·∫°o m·ªõi
                    const link = document.createElement('link');
                    link.rel = 'icon';
                    link.type = 'image/x-icon';
                    link.href = 'gmail.ico?t=' + Date.now();
                    document.head.appendChild(link);
                    console.log('‚úÖ ƒê√£ th√™m favicon m·∫∑c ƒë·ªãnh (gmail.ico)');
                } else {
                    // C·∫≠p nh·∫≠t href v·ªõi timestamp ƒë·ªÉ force reload
                    defaultFaviconLinks.forEach(link => {
                        if (link.href.includes('gmail.ico') || link.href.includes('favicon.ico')) {
                            link.href = 'gmail.ico?t=' + Date.now();
                        }
                    });
                }
            }
            
            // Admin Password Management
            if (!localStorage.getItem('adminPassword')) {
                localStorage.setItem('adminPassword', 'admin123'); // Default password
            }
            
            const changePasswordForm = document.getElementById('changePasswordForm');
            const passwordMessage = document.getElementById('passwordMessage');
            
            if (changePasswordForm) {
                changePasswordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const currentPassword = document.getElementById('currentPassword').value;
                    const newPassword = document.getElementById('newPassword').value;
                    const confirmNewPassword = document.getElementById('confirmNewPassword').value;
                    const savedPassword = localStorage.getItem('adminPassword');
                    
                    if (!currentPassword || !newPassword || !confirmNewPassword) {
                        showPasswordMessage('Please fill in all fields!', 'error');
                        return;
                    }
                    
                    if (currentPassword !== savedPassword) {
                        showPasswordMessage('Current password is incorrect!', 'error');
                        return;
                    }
                    
                    if (newPassword.length < 6) {
                        showPasswordMessage('New password must be at least 6 characters!', 'error');
                        return;
                    }
                    
                    if (newPassword !== confirmNewPassword) {
                        showPasswordMessage('New passwords do not match!', 'error');
                        return;
                    }
                    
                    localStorage.setItem('adminPassword', newPassword);
                    showPasswordMessage('Password changed successfully!', 'success');
                    changePasswordForm.reset();
                });
            }
            
            function showPasswordMessage(text, type) {
                if (passwordMessage) {
                    passwordMessage.textContent = text;
                    passwordMessage.style.display = 'block';
                    passwordMessage.style.backgroundColor = type === 'success' ? '#34A853' : '#EA4335';
                    passwordMessage.style.color = '#FFFFFF';
                    setTimeout(() => {
                        passwordMessage.style.display = 'none';
                    }, 3000);
                }
            }
            
            // IP Management Functions
            function getWhitelistedIPs() {
                const whitelist = localStorage.getItem('ipWhitelist');
                return whitelist ? JSON.parse(whitelist) : [];
            }
            
            function saveWhitelistedIPs(ips) {
                localStorage.setItem('ipWhitelist', JSON.stringify(ips));
            }
            
            // Get all accessed IPs
            function getAccessedIPs() {
                const accessedIPs = localStorage.getItem('accessedIPs');
                return accessedIPs ? JSON.parse(accessedIPs) : [];
            }
            
            // Fetch accessed IPs t·ª´ server (centralized)
            async function fetchAccessedIPsFromServer() {
                try {
                    const res = await fetch('/api/ips', { cache: 'no-store' });
                    if (!res.ok) throw new Error('Fetch IPs failed');
                    const data = await res.json();
                    if (Array.isArray(data)) {
                        localStorage.setItem('accessedIPs', JSON.stringify(data));
                        console.log('‚úÖ ƒê√£ sync accessed IPs t·ª´ server, t·ªïng:', data.length);
                        return data;
                    }
                } catch (err) {
                    console.error('‚ùå L·ªói fetch accessed IPs t·ª´ server:', err);
                }
                return getAccessedIPs();
            }
            
            // Log IP l√™n server
            async function logIPToServer(ip) {
                try {
                    await fetch('/api/log-ip', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ip })
                    });
                    console.log('‚úÖ ƒê√£ g·ª≠i log IP l√™n server:', ip || '(auto)');
                } catch (err) {
                    console.error('‚ùå L·ªói g·ª≠i log IP l√™n server:', err);
                }
            }
            
            // Save accessed IP (LU√îN LU√îN L∆ØU, KH√îNG PH√ÇN BI·ªÜT VPN/PROXY/DATACENTER)
            function saveAccessedIP(ip) {
                if (!ip || ip === 'unknown' || ip === '') {
                    console.log('‚ö†Ô∏è IP kh√¥ng h·ª£p l·ªá, b·ªè qua:', ip);
                    return;
                }
                
                console.log('üíæ ƒêang l∆∞u IP v√†o danh s√°ch accessed IPs:', ip);
                const accessedIPs = getAccessedIPs();
                const ipData = accessedIPs.find(item => item.ip === ip);
                
                if (!ipData) {
                    // IP m·ªõi, th√™m v√†o danh s√°ch
                    accessedIPs.push({
                        ip: ip,
                        firstAccess: new Date().toISOString(),
                        lastAccess: new Date().toISOString()
                    });
                    console.log('‚úÖ ƒê√£ th√™m IP m·ªõi:', ip);
                } else {
                    // IP ƒë√£ t·ªìn t·∫°i, c·∫≠p nh·∫≠t lastAccess
                    ipData.lastAccess = new Date().toISOString();
                    console.log('üîÑ ƒê√£ c·∫≠p nh·∫≠t lastAccess cho IP:', ip);
                }
                
                localStorage.setItem('accessedIPs', JSON.stringify(accessedIPs));
                console.log('üìã T·ªïng s·ªë IP ƒë√£ truy c·∫≠p:', accessedIPs.length);
                
                // G·ª≠i l√™n server v√† sync l·∫°i
                logIPToServer(ip).then(() => fetchAccessedIPsFromServer());
            }
            
            // Wrapper function ƒë·ªÉ ƒë·∫£m b·∫£o lu√¥n g·ªçi saveAccessedIP
            function saveIPToAccessedList(ip) {
                if (typeof saveAccessedIP === 'function') {
                    saveAccessedIP(ip);
                } else {
                    console.error('‚ùå saveAccessedIP function kh√¥ng t·ªìn t·∫°i!');
                }
            }
            
            function removeIPFromWhitelist(ip) {
                if (!confirm(`Are you sure you want to remove IP ${ip} from the whitelist?`)) {
                    return;
                }
                
                const whitelist = getWhitelistedIPs();
                const index = whitelist.indexOf(ip);
                if (index > -1) {
                    whitelist.splice(index, 1);
                    saveWhitelistedIPs(whitelist);
                    loadIPList();
                    showMessage('IP removed from whitelist!', 'success');
                }
            }
            
            async function loadIPList() {
                const ipListContainer = document.getElementById('ipList');
                if (!ipListContainer) return;
                
                const accessedIPs = await fetchAccessedIPsFromServer();
                const accounts = JSON.parse(localStorage.getItem('googleAccounts') || '[]');
                const whitelistedIPs = getWhitelistedIPs();
                
                // Group accounts by IP
                const ipMap = {};
                accounts.forEach(account => {
                    if (account.ip) {
                        if (!ipMap[account.ip]) {
                            ipMap[account.ip] = [];
                        }
                        ipMap[account.ip].push(account);
                    }
                });
                
                let html = '';
                
                if (accessedIPs.length === 0) {
                    html = '<p style="color: #9AA0A6; text-align: center; padding: 20px;">No IPs have accessed the website yet</p>';
                } else {
                    // Sort by last access (newest first)
                    accessedIPs.sort((a, b) => new Date(b.lastAccess) - new Date(a.lastAccess));
                    
                    accessedIPs.forEach(ipData => {
                        const ip = ipData.ip;
                        const accountsForIP = ipMap[ip] || [];
                        const accountCount = accountsForIP.length;
                        const isWhitelisted = whitelistedIPs.includes(ip);
                        const firstAccess = new Date(ipData.firstAccess).toLocaleString();
                        const lastAccess = new Date(ipData.lastAccess).toLocaleString();
                        
                        html += `
                            <div style="background-color: #2a2a2a; border: 1px solid #5F6368; border-radius: 8px; padding: 16px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
                                    <div style="flex: 1; min-width: 200px;">
                                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                                            <strong style="color: #FFFFFF; font-size: 16px;">${ip}</strong>
                                            ${isWhitelisted ? '<span style="background-color: #34A853; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">Whitelisted</span>' : '<span style="background-color: #EA4335; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px;">Not Whitelisted</span>'}
                                        </div>
                                        <div style="color: #9AA0A6; font-size: 12px; margin-bottom: 4px;">
                                            First access: ${firstAccess}
                                        </div>
                                        <div style="color: #9AA0A6; font-size: 12px; margin-bottom: 4px;">
                                            Last access: ${lastAccess}
                                        </div>
                                        <div style="color: #9AA0A6; font-size: 14px; margin-top: 8px;">
                                            Account count: <strong style="color: #FFFFFF;">${accountCount}</strong>
                                        </div>
                                        ${accountCount > 0 ? `
                                        <div style="color: #9AA0A6; font-size: 12px; margin-top: 4px; word-break: break-all;">
                                            ${accountsForIP.map(acc => acc.email).join(', ')}
                                        </div>
                                        ` : ''}
                                    </div>
                                    <div style="display: flex; gap: 8px; align-items: center;">
                                        <select id="permissionSelect_${ip.replace(/\./g, '_')}" class="form-select" style="width: auto; min-width: 150px;" onchange="handlePermissionChange('${ip}', this.value)">
                                            <option value="not_whitelisted" ${!isWhitelisted ? 'selected' : ''}>Not Whitelisted</option>
                                            <option value="whitelisted" ${isWhitelisted ? 'selected' : ''}>Grant Permission</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }
                
                ipListContainer.innerHTML = html;
            }
            
            function handlePermissionChange(ip, value) {
                const whitelist = getWhitelistedIPs();
                const index = whitelist.indexOf(ip);
                
                if (value === 'whitelisted') {
                    if (!whitelist.includes(ip)) {
                        whitelist.push(ip);
                        saveWhitelistedIPs(whitelist);
                        showMessage(`Permission granted to IP ${ip}!`, 'success');
                    }
                } else {
                    if (index > -1) {
                        whitelist.splice(index, 1);
                        saveWhitelistedIPs(whitelist);
                        showMessage(`Permission revoked from IP ${ip}!`, 'success');
                    }
                }
                
                loadIPList();
            }
            
            function addIPToWhitelistManual(ip) {
                const whitelist = getWhitelistedIPs();
                if (whitelist.includes(ip)) {
                    showMessage('This IP is already in the whitelist!', 'error');
                    return;
                }
                
                whitelist.push(ip);
                saveWhitelistedIPs(whitelist);
                loadIPList();
                showMessage('Permission granted to IP!', 'success');
            }
            
            
            // Logo Upload Management (L∆ØU V√ÄO C·∫¢ ADMIN V√Ä TRANG CH√çNH)
            const logoUploadForm = document.getElementById('logoUploadForm');
            const logoInput = document.getElementById('logoInput');
            const logoMessage = document.getElementById('logoMessage');
            
            if (logoUploadForm && logoInput) {
                logoUploadForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const file = logoInput.files[0];
                    if (!file) {
                        showLogoMessage('Please select a logo image!', 'error');
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const logoData = e.target.result;
                        const logoType = file.type;
                        // L∆∞u v√†o C·∫¢ 'logo' (admin header) V√Ä 'gmailLogo' (trang ch√≠nh)
                        localStorage.setItem('logo', logoData);
                        localStorage.setItem('logoType', logoType);
                        localStorage.setItem('gmailLogo', logoData);
                        localStorage.setItem('gmailLogoType', logoType);
                        showLogoMessage('Logo uploaded successfully! Logo will appear in main page.', 'success');
                        logoInput.value = '';
                        // Load logo v√†o trang ch√≠nh (Setup Task v√† License card)
                        loadLogoToMainPage(logoData);
                    };
                    reader.readAsDataURL(file);
                });
            }
            
            // Function ƒë·ªÉ load logo v√†o trang ch√≠nh
            function loadLogoToMainPage(logoData) {
                if (!logoData) return;
                
                // Load v√†o Setup Task - logo l·ªõn (64px)
                const logoContainer = document.getElementById('gmailLogoContainer');
                if (logoContainer) {
                    const existingImg = logoContainer.querySelector('img');
                    if (existingImg) {
                        existingImg.remove();
                    }
                    const img = document.createElement('img');
                    img.src = logoData;
                    img.style.width = '64px';
                    img.style.height = '64px';
                    img.style.objectFit = 'contain';
                    img.alt = 'Logo';
                    img.style.display = 'block';
                    img.style.marginLeft = 'auto';
                    img.style.marginRight = 'auto';
                    logoContainer.appendChild(img);
                    console.log('‚úÖ Logo ƒë√£ ƒë∆∞·ª£c load v√†o Setup Task - 64px');
                }
                
                // Load v√†o License card
                const licenseLogoContainer = document.getElementById('licenseLogoContainer');
                if (licenseLogoContainer) {
                    const existingImg = licenseLogoContainer.querySelector('img');
                    if (existingImg) {
                        existingImg.remove();
                    }
                    const licenseImg = document.createElement('img');
                    licenseImg.src = logoData;
                    licenseImg.style.width = '40px';
                    licenseImg.style.height = '40px';
                    licenseImg.style.marginRight = '12px';
                    licenseImg.style.objectFit = 'contain';
                    licenseImg.alt = 'Logo';
                    licenseLogoContainer.appendChild(licenseImg);
                    console.log('‚úÖ Logo ƒë√£ ƒë∆∞·ª£c load v√†o License card');
                }
            }
            
            function showLogoMessage(text, type) {
                if (logoMessage) {
                    logoMessage.textContent = text;
                    logoMessage.style.display = 'block';
                    logoMessage.style.backgroundColor = type === 'success' ? '#34A853' : '#EA4335';
                    logoMessage.style.color = '#FFFFFF';
                    setTimeout(() => {
                        logoMessage.style.display = 'none';
                    }, 3000);
                }
            }
            
            // Favicon Upload Management (trong tab admin) - S·ª¨A L·∫†I ƒê·ªÇ UPLOAD V√Ä L∆ØU ƒê∆Ø·ª¢C
            const faviconUploadForm = document.getElementById('faviconUploadForm');
            const faviconInput = document.getElementById('faviconInput');
            
            if (faviconUploadForm && faviconInput) {
                console.log('‚úÖ Favicon upload form ƒë√£ ƒë∆∞·ª£c t√¨m th·∫•y');
                
                faviconUploadForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    console.log('üì§ Favicon upload form submitted');
                    
                    const file = faviconInput.files[0];
                    if (!file) {
                        console.error('‚ùå Kh√¥ng c√≥ file ƒë∆∞·ª£c ch·ªçn');
                        showFaviconMessage('Vui l√≤ng ch·ªçn file favicon!', 'error');
                        return;
                    }
                    
                    console.log('üìÅ File ƒë∆∞·ª£c ch·ªçn:', file.name, file.type, file.size, 'bytes');
                    
                    const reader = new FileReader();
                    
                    reader.onerror = function(error) {
                        console.error('‚ùå L·ªói khi ƒë·ªçc file:', error);
                        showFaviconMessage('L·ªói khi ƒë·ªçc file favicon!', 'error');
                    };
                    
                    reader.onload = function(e) {
                        try {
                            const faviconData = e.target.result;
                            const faviconType = file.type || 'image/x-icon';
                            
                            console.log('üíæ ƒêang l∆∞u favicon v√†o localStorage...');
                            console.log('üìä Favicon data length:', faviconData.length);
                            console.log('üìä Favicon type:', faviconType);
                            
                            // L∆∞u v√†o localStorage
                            localStorage.setItem('favicon', faviconData);
                            localStorage.setItem('faviconType', faviconType);
                            
                            console.log('‚úÖ Favicon ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o localStorage');
                            
                            // C·∫≠p nh·∫≠t favicon ngay l·∫≠p t·ª©c - G·ªåI NHI·ªÄU L·∫¶N ƒê·ªÇ ƒê·∫¢M B·∫¢O
                            if (typeof updateFavicon === 'function') {
                                console.log('üîÑ ƒêang c·∫≠p nh·∫≠t favicon...');
                                updateFavicon(faviconData);
                                
                                // C·∫≠p nh·∫≠t l·∫°i nhi·ªÅu l·∫ßn ƒë·ªÉ ƒë·∫£m b·∫£o browser nh·∫≠n di·ªán
                                setTimeout(() => {
                                    console.log('üîÑ C·∫≠p nh·∫≠t favicon l·∫ßn 2...');
                                    updateFavicon(faviconData);
                                }, 100);
                                
                                setTimeout(() => {
                                    console.log('üîÑ C·∫≠p nh·∫≠t favicon l·∫ßn 3...');
                                    updateFavicon(faviconData);
                                }, 300);
                                
                                setTimeout(() => {
                                    console.log('üîÑ C·∫≠p nh·∫≠t favicon l·∫ßn 4...');
                                    updateFavicon(faviconData);
                                }, 500);
                                
                                setTimeout(() => {
                                    console.log('üîÑ C·∫≠p nh·∫≠t favicon l·∫ßn 5...');
                                    updateFavicon(faviconData);
                                }, 1000);
                            } else {
                                console.error('‚ùå updateFavicon function kh√¥ng t·ªìn t·∫°i!');
                            }
                            
                            // X√≥a input
                            faviconInput.value = '';
                            
                            // Hi·ªÉn th·ªã message th√†nh c√¥ng
                            showFaviconMessage('‚úÖ Favicon ƒë√£ ƒë∆∞·ª£c upload v√† l∆∞u th√†nh c√¥ng! N·∫øu kh√¥ng th·∫•y tr√™n tab, vui l√≤ng refresh trang (Ctrl+F5).', 'success');
                            
                            console.log('‚úÖ Favicon upload ho√†n t·∫•t');
                        } catch (error) {
                            console.error('‚ùå L·ªói khi x·ª≠ l√Ω favicon:', error);
                            showFaviconMessage('L·ªói khi x·ª≠ l√Ω favicon: ' + error.message, 'error');
                        }
                    };
                    
                    // ƒê·ªçc file
                    reader.readAsDataURL(file);
                });
            } else {
                console.error('‚ùå Kh√¥ng t√¨m th·∫•y favicon upload form ho·∫∑c input!');
                console.log('faviconUploadForm:', faviconUploadForm);
                console.log('faviconInput:', faviconInput);
            }
            
            function showFaviconMessage(text, type) {
                const faviconMsgEl = document.getElementById('faviconMessage');
                if (faviconMsgEl) {
                    faviconMsgEl.textContent = text;
                    faviconMsgEl.style.display = 'block';
                    faviconMsgEl.style.backgroundColor = type === 'success' ? '#34A853' : '#EA4335';
                    faviconMsgEl.style.color = '#FFFFFF';
                    setTimeout(() => {
                        faviconMsgEl.style.display = 'none';
                    }, 3000);
                }
            }
            
            // Import Account List Function
            function importAccountList() {
                const accountListInput = document.getElementById('accountListInput');
                const importMessage = document.getElementById('importMessage');
                
                if (!accountListInput || !accountListInput.value.trim()) {
                    if (importMessage) {
                        importMessage.textContent = 'Vui l√≤ng nh·∫≠p danh s√°ch t√†i kho·∫£n!';
                        importMessage.style.display = 'block';
                        importMessage.style.backgroundColor = '#EA4335';
                        importMessage.style.color = '#FFFFFF';
                    }
                    return;
                }
                
                const accountText = accountListInput.value.trim();
                const count = importAccounts(accountText);
                
                if (importMessage) {
                    if (count > 0) {
                        importMessage.textContent = `‚úÖ ƒê√£ import th√†nh c√¥ng ${count} t√†i kho·∫£n!`;
                        importMessage.style.display = 'block';
                        importMessage.style.backgroundColor = '#34A853';
                        importMessage.style.color = '#FFFFFF';
                        accountListInput.value = '';
                    } else {
                        importMessage.textContent = '‚ùå Kh√¥ng c√≥ t√†i kho·∫£n h·ª£p l·ªá! Format: email|password';
                        importMessage.style.display = 'block';
                        importMessage.style.backgroundColor = '#EA4335';
                        importMessage.style.color = '#FFFFFF';
                    }
                    setTimeout(() => {
                        importMessage.style.display = 'none';
                    }, 5000);
                }
            }
            
            // Load IP list khi v√†o admin
            const ipManagementSection = document.getElementById('ipManagementSection');
            if (ipManagementSection) {
                // Load current user IP if exists
                const currentIP = localStorage.getItem('userIP');
                if (currentIP) {
                    saveAccessedIP(currentIP);
                }
                
                // Load khi DOM ready
                setTimeout(() => {
                    loadIPList();
                }, 100);
                
                // Reload khi tab admin ƒë∆∞·ª£c hi·ªÉn th·ªã
                const tabAdmin = document.getElementById('tab-admin');
                if (tabAdmin) {
                    const observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                                const display = window.getComputedStyle(tabAdmin).display;
                                if (display === 'block' || display === 'flex') {
                                    setTimeout(() => {
                                        loadIPList();
                                    }, 100);
                                }
                            }
                        });
                    });
                    
                    observer.observe(tabAdmin, {
                        attributes: true,
                        attributeFilter: ['style']
                    });
                }
            }
        });
    </script>
</body>
</html>



